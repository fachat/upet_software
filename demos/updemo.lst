
updemo.a65


viccy.i65


    5 A:1000                                    VCCY_HDISP=1
    6 A:1000                                    VCCY_HDISP_MM=5
    7 A:1000                                    VCCY_VDISP=6
    8 A:1000                                    VCCY_MODE=8
    9 A:1000                                    VCCY_CHEIGHT=9
   10 A:1000                                    VCCY_CRSR_STRT=10
   11 A:1000                                    VCCY_CRSR_END=11
   12 A:1000                                    VCCY_MEM_STRT_H=12
   13 A:1000                                    VCCY_MEM_STRT_L=13
   14 A:1000                                    VCCY_CRSR_POS_H=14
   15 A:1000                                    VCCY_CRSR_POS_L=15
   16 A:1000                                    VCCY_ATT_STRT_H=20
   17 A:1000                                    VCCY_ATT_STRT_L=21
   18 A:1000                                    VCCY_CHR_HDISP=22
   19 A:1000                                    VCCY_CHR_VDISP=23
   20 A:1000                                    VCCY_VSCRL=24
   21 A:1000                                    VCCY_HSCRL=25
   22 A:1000                                    VCCY_FGBG_COLS=26
   23 A:1000                                    VCCY_ROW_INC=27
   24 A:1000                                    VCCY_CSET_STRT_H=28
   25 A:1000                                    VCCY_ULINE=29
   26 A:1000                                    VCCY_RLINE_L=30
   27 A:1000                                    VCCY_RLINE_H=31
   28 A:1000                                    VCCY_CTRL=32
   29 A:1000                                    VCCY_EXT_BGCOLS=33
   30 A:1000                                    VCCY_BRDR_COL=34
   31 A:1000                                    VCCY_IRQ_CTRL=35
   32 A:1000                                    VCCY_IRQ_STAT=36
   33 A:1000                                    VCCY_SYNC=37
   34 A:1000                                    VCCY_HPOS=38
   35 A:1000                                    VCCY_VPOS=39
   36 A:1000                                    VCCY_ALT1=40
   37 A:1000                                    VCCY_ALT2=41

   39 A:1000                                    VCCY_CTRL_ATTR=%00000001
   40 A:1000                                    VCCY_CTRL_BITMAP=%00000010
   41 A:1000                                    VCCY_CTRL_EXT=%00000100
   42 A:1000                                    VCCY_CTRL_DISPEN=%00010000
   43 A:1000                                    VCCY_CTRL_PALSEL=%00100000
   44 A:1000                                    VCCY_CTRL_REGMAP=%01000000
   45 A:1000                                    VCCY_CTRL_COMPAT=%10000000

   47 A:1000                                    VCCY_SPRT_BASE=42
   48 A:1000                                    VCCY_SPRT_BRDR=43
   49 A:1000                                    VCCY_SPRT_SPRT=44
   50 A:1000                                    VCCY_SPRT_RSTR=45
   51 A:1000                                    VCCY_SPRT_MCOL1=46
   52 A:1000                                    VCCY_SPRT_MCOL2=47

   54 A:1000                                    VCCY_SPRT_BASE_0=48
   55 A:1000                                    VCCY_SPRT_BASE_1=52
   56 A:1000                                    VCCY_SPRT_BASE_2=56
   57 A:1000                                    VCCY_SPRT_BASE_3=60
   58 A:1000                                    VCCY_SPRT_BASE_4=64
   59 A:1000                                    VCCY_SPRT_BASE_5=68
   60 A:1000                                    VCCY_SPRT_BASE_6=72
   61 A:1000                                    VCCY_SPRT_BASE_7=76

   63 A:1000                                    VCCY_SPRT_COL_0=80
   64 A:1000                                    VCCY_SPRT_COL_1=81
   65 A:1000                                    VCCY_SPRT_COL_2=82
   66 A:1000                                    VCCY_SPRT_COL_3=83
   67 A:1000                                    VCCY_SPRT_COL_4=84
   68 A:1000                                    VCCY_SPRT_COL_5=85
   69 A:1000                                    VCCY_SPRT_COL_6=86
   70 A:1000                                    VCCY_SPRT_COL_7=87

   72 A:1000                                    SPRT_XPOS=0
   73 A:1000                                    SPRT_YPOS=1
   74 A:1000                                    SPRT_XYPOS=2
   75 A:1000                                    SPRT_CTRL=3

   77 A:1000                                    SPRT_CTRL_EN=%00000001
   78 A:1000                                    SPRT_CTRL_XEXP=%00000010
   79 A:1000                                    SPRT_CTRL_YEXP=%00000100
   80 A:1000                                    SPRT_CTRL_MCOL=%00001000
   81 A:1000                                    SPRT_CTRL_BGPRIO=%00010000
   82 A:1000                                    SPRT_CTRL_BRPRIO=%00100000
   83 A:1000                                    SPRT_CTRL_DRES=%01000000
   84 A:1000                                    SPRT_CTRL_ALTPAL=%10000000

   86 A:1000                                    VCCY_PAL_BASE=88

updemo.a65


    4 A:1000                                    ; if defined, print out some measurements for timers etc instead of just OKing

    7 A:1000                                    CHAR=$080000+3*16

    9 A:1000                                    irqvec=$90

   11 A:1000                                    VDC=$e880
   12 A:1000                                    VCTRL=$e800
   13 A:1000                                    SCTRL=$e803

   15 A:1000                                    SPEED=3

   17 A:1000                                    BRDCOL=0           ; black
   18 A:1000                                    BGCOL=0           ; black
   19 A:1000                                    FGCOL=5           ; light green

   21 A:1000                                    HOME=19
   22 A:1000                                    CRSD=17
   23 A:1000                                    CR=13

   25 A:1000                                    p1=$02
   26 A:1000                                    p2=$04
   27 A:1000                                    tmp=$06
   28 A:1000                                    cnt=$08
   29 A:1000                                    cnt2=$09
   30 A:1000                                    tmp2=$0a

   32 A:1000                                    BSOUT=$ffd2

   34 A:1000                                    OFFSET70=0           ;22

   36 A:1000  01 04                              .word $0401
   37 A:1002                                     *= $0401

   39 A:0401  0b 04                              .word link
   40 A:0403  0a 00                              .word 10              ; line number
   41 A:0405  9e 31 30 34 30                     .byt $9e,"1040"
   42 A:040a  00                                 .byt 0
   43 A:040b  00 00                    link      .byt $00,$00

   45 A:040d  aa ff 10                           .dsb $0410-*,$aa

   47 A:0410                           l1000                      ; start of program

   49 A:0410  78                                 sei 
   50 A:0411  20 19 11                           jsr iniirq
   51 A:0414                           loop      
   52 A:0414  20 4a 11                           jsr clrviccy
   53 A:0417  20 ee 11                           jsr clrscr
   54 A:041a  20 c7 10                           jsr inichain
   55 A:041d  58                                 cli 

   57 A:041e                                    ;lda #0
   58 A:041e                                    ;sta vdctab+VCCY_VSCRL

   60 A:041e  20 67 04                           jsr demo1                ; print header
   61 A:0421  20 47 07                           jsr demoborders                ; rasterline ints & borders
   62 A:0424  20 b7 04                           jsr demovdc
   63 A:0427  20 25 05                           jsr democpet
   64 A:042a  20 87 05                           jsr demomcol
   65 A:042d  20 d9 05                           jsr demoilace
   66 A:0430  20 24 06                           jsr democursor
   67 A:0433  20 70 06                           jsr demohwpos
   68 A:0436  20 d9 06                           jsr demohscrl
   69 A:0439  20 a3 07                           jsr demovert
   70 A:043c  20 7e 08                           jsr demo4080
   71 A:043f  20 d6 08                           jsr demo50rows
   72 A:0442  20 58 09                           jsr democset
   73 A:0445  20 b6 0a                           jsr demoreset
   74 A:0448  20 5d 0a                           jsr demohires
   75 A:044b  20 c9 0c                           jsr demosprites
   76 A:044e  20 47 0e                           jsr demopalette
   77 A:0451                                    ;jsr demodynpos

   79 A:0451  20 44 12                           jsr wait
   80 A:0454  20 44 12                           jsr wait
   81 A:0457  20 44 12                           jsr wait
   82 A:045a                                    ;x jmp x
   83 A:045a  20 c0 10                           jsr stopirq
   84 A:045d  78                                 sei 
   85 A:045e  20 9c 10                           jsr resetchain
   86 A:0461  20 7e 11                           jsr setviccy
   87 A:0464  4c 14 04                           jmp loop

   90 A:0467                                    ; ---------------------------------------------------------

   92 A:0467                                     .( 
   93 A:0467  a9 71                    demo1     lda #<txt
   94 A:0469  a0 04                              ldy #>txt
   95 A:046b  20 33 12                           jsr txtout
   96 A:046e  4c 44 12                           jmp wait

   98 A:0471  13 11 11                 txt       .asc HOME,CRSD,CRSD
   99 A:0474  20 20 20 20 20 20 20 ...           .asc "           THE ULTRACPU BOARD ... ON THE WAY TO THE ULTIMATE PET!"
  100 A:04b5  0d 00                              .asc CR,0
  101 A:04b7                                     .) 

  103 A:04b7                                    ; --------------------

  105 A:04b7                                     .( 
  106 A:04b7                           demovdc   
  107 A:04b7  a9 e9                              lda #<txt
  108 A:04b9  a0 04                              ldy #>txt
  109 A:04bb  20 33 12                           jsr txtout

  111 A:04be  a0 00                              ldy #0
  112 A:04c0  98                       l0        tya 
  113 A:04c1  99 9a 89                           sta $8800+5*80+10,y
  114 A:04c4  c8                                 iny 
  115 A:04c5  c0 3c                              cpy #60
  116 A:04c7  90 f7                              bcc l0

  118 A:04c9  a9 e3                              lda #<itab
  119 A:04cb  a0 04                              ldy #>itab
  120 A:04cd  20 5a 10                           jsr addirq

  122 A:04d0  4c 44 12                           jmp wait

  124 A:04d3                           idemo2    
  125 A:04d3  a2 20                              ldx #VCCY_CTRL
  126 A:04d5  a9 11                              lda #16+1
  127 A:04d7  20 43 11                           jsr sreg                ; disable ColourPet mode, enable attribute mode
  128 A:04da                                    ; ldx #VCCY_HSCRL
  129 A:04da                                    ; lda #64+16
  130 A:04da                                    ; jsr sreg ; enable VDC attribute mode

  132 A:04da  a9 22                              lda #VCCY_BRDR_COL
  133 A:04dc  8d 80 e8                           sta VDC
  134 A:04df  ee 81 e8                           inc VDC+1
  135 A:04e2  60                                 rts 

  137 A:04e3  d2 04                    itab      .word idemo2-1
  138 A:04e5  95 00                              .word 149+OFFSET70
  139 A:04e7  00 00                              .word 0

  142 A:04e9  20 20 20 20 20 20 20 ... txt       .asc "           * C128 VDC COMPATIBLE MODE WITH BLINK/UNDERLINE"
  143 A:0523  0d 00                              .asc CR,0
  144 A:0525                                     .) 

  146 A:0525                                    ; --------------------

  148 A:0525                                     .( 
  149 A:0525                           democpet  
  150 A:0525  a9 57                              lda #<txt
  151 A:0527  a0 05                              ldy #>txt
  152 A:0529  20 33 12                           jsr txtout

  154 A:052c  a0 00                              ldy #0
  155 A:052e  98                       l0        tya 
  156 A:052f  99 ea 89                           sta $8800+6*80+10,y
  157 A:0532  c8                                 iny 
  158 A:0533  c0 3c                              cpy #60
  159 A:0535  90 f7                              bcc l0

  161 A:0537  a9 51                              lda #<itab
  162 A:0539  a0 05                              ldy #>itab
  163 A:053b  20 5a 10                           jsr addirq

  165 A:053e  4c 44 12                           jmp wait

  167 A:0541                           idemo3    
  168 A:0541  a2 20                              ldx #VCCY_CTRL
  169 A:0543  a9 14                              lda #20
  170 A:0545  20 43 11                           jsr sreg                ; enable ColourPet mode, disabel attr. mode
  171 A:0548                                    ; ldx #VCCY_HSCRL
  172 A:0548                                    ; lda #0+16
  173 A:0548                                    ; jsr sreg ; disable VDC attribute mode

  175 A:0548  a9 22                              lda #VCCY_BRDR_COL
  176 A:054a  8d 80 e8                           sta VDC
  177 A:054d  ee 81 e8                           inc VDC+1
  178 A:0550  60                                 rts 

  180 A:0551  40 05                    itab      .word idemo3-1
  181 A:0553  b9 00                              .word 167+18+OFFSET70
  182 A:0555  00 00                              .word 0

  184 A:0557  20 20 20 20 20 20 20 ... txt       .asc "           * COLOUR PET COMPATIBLE COLOUR MODE"
  185 A:0585  0d 00                              .asc CR,0
  186 A:0587                                     .) 

  188 A:0587                                    ; --------------------

  190 A:0587                                     .( 
  191 A:0587                           demomcol  
  192 A:0587  a9 b9                              lda #<txt
  193 A:0589  a0 05                              ldy #>txt
  194 A:058b  20 33 12                           jsr txtout

  196 A:058e  a0 00                              ldy #0
  197 A:0590  98                       l0        tya 
  198 A:0591  99 3a 8a                           sta $8800+7*80+10,y
  199 A:0594  c8                                 iny 
  200 A:0595  c0 3c                              cpy #60
  201 A:0597  90 f7                              bcc l0

  203 A:0599  a9 b3                              lda #<itab
  204 A:059b  a0 05                              ldy #>itab
  205 A:059d  20 5a 10                           jsr addirq

  207 A:05a0  4c 44 12                           jmp wait

  209 A:05a3                           idemo3    
  210 A:05a3  a2 20                              ldx #VCCY_CTRL
  211 A:05a5  a9 15                              lda #20+1
  212 A:05a7  20 43 11                           jsr sreg                ; enable multicol mode 
  213 A:05aa                                    ; ldx #VCCY_HSCRL
  214 A:05aa                                    ; lda #64+16
  215 A:05aa                                    ; jsr sreg ; enable VDC attribute mode (+cpet =multicolour)

  217 A:05aa  a9 22                              lda #VCCY_BRDR_COL
  218 A:05ac  8d 80 e8                           sta VDC
  219 A:05af  ee 81 e8                           inc VDC+1
  220 A:05b2  60                                 rts 

  222 A:05b3  a2 05                    itab      .word idemo3-1
  223 A:05b5  cb 00                              .word 185+18+OFFSET70
  224 A:05b7  00 00                              .word 0

  226 A:05b9  20 20 20 20 20 20 20 ... txt       .asc "           * MULTI-COLOUR MODE"
  227 A:05d7  0d 00                              .asc CR,0
  228 A:05d9                                     .) 

  230 A:05d9                                    ; --------------------

  232 A:05d9                                     .( 
  233 A:05d9                           demoilace 
  234 A:05d9  a9 07                              lda #<txt
  235 A:05db  a0 06                              ldy #>txt
  236 A:05dd  20 33 12                           jsr txtout

  238 A:05e0  a9 01                              lda #<itab
  239 A:05e2  a0 06                              ldy #>itab
  240 A:05e4  20 5a 10                           jsr addirq

  242 A:05e7  4c 44 12                           jmp wait

  244 A:05ea                           idemo4    
  245 A:05ea  a2 20                              ldx #VCCY_CTRL
  246 A:05ec  a9 14                              lda #20
  247 A:05ee  20 43 11                           jsr sreg                ; enable attrib mode 
  248 A:05f1                                    ; ldx #VCCY_HSCRL
  249 A:05f1                                    ; lda #16
  250 A:05f1                                    ; jsr sreg

  252 A:05f1  a2 08                              ldx #VCCY_MODE
  253 A:05f3  a9 82                              lda #2+128
  254 A:05f5  20 43 11                           jsr sreg                ; interlace mode

  256 A:05f8  a9 22                              lda #VCCY_BRDR_COL
  257 A:05fa  8d 80 e8                           sta VDC
  258 A:05fd  ee 81 e8                           inc VDC+1
  259 A:0600  60                                 rts 

  261 A:0601  e9 05                    itab      .word idemo4-1
  262 A:0603  dd 00                              .word 203+18+OFFSET70
  263 A:0605  00 00                              .word 0

  265 A:0607  20 20 20 20 20 20 20 ... txt       .asc "           * INTERLACE MODE"
  266 A:0622  0d 00                              .asc CR,0
  267 A:0624                                     .) 

  269 A:0624                                    ; --------------------

  271 A:0624                                     .( 
  272 A:0624                           democursor 
  273 A:0624  a9 52                              lda #<txt
  274 A:0626  a0 06                              ldy #>txt
  275 A:0628  20 33 12                           jsr txtout

  277 A:062b  a9 4c                              lda #<itab
  278 A:062d  a0 06                              ldy #>itab
  279 A:062f  20 5a 10                           jsr addirq

  281 A:0632  4c 44 12                           jmp wait

  283 A:0635                           idemo5    
  284 A:0635  a2 0a                              ldx #10
  285 A:0637  a9 40                              lda #0+64       ; cursor blink on 
  286 A:0639  20 43 11                           jsr sreg

  288 A:063c  a2 08                              ldx #VCCY_MODE
  289 A:063e  a9 80                              lda #128
  290 A:0640  20 43 11                           jsr sreg                ; interlace mode off

  292 A:0643  a9 22                              lda #VCCY_BRDR_COL
  293 A:0645  8d 80 e8                           sta VDC
  294 A:0648  ee 81 e8                           inc VDC+1
  295 A:064b  60                                 rts 

  297 A:064c  34 06                    itab      .word idemo5-1
  298 A:064e  ec 00                              .word 218+18+OFFSET70
  299 A:0650  00 00                              .word 0

  301 A:0652  20 20 20 20 20 20 20 ... txt       .asc "           * HARDWARE CURSOR"
  302 A:066e  0d 00                              .asc CR,0
  303 A:0670                                     .) 

  305 A:0670                                    ; --------------------

  308 A:0670                                     .( 
  309 A:0670                           demohwpos 
  310 A:0670  a9 ad                              lda #<txt
  311 A:0672  a0 06                              ldy #>txt
  312 A:0674  20 33 12                           jsr txtout

  314 A:0677  a9 a7                              lda #<itab
  315 A:0679  a0 06                              ldy #>itab
  316 A:067b  20 5a 10                           jsr addirq

  318 A:067e  4c 44 12                           jmp wait

  320 A:0681                           idemo5    
  321 A:0681  a2 26                              ldx #VCCY_HPOS
  322 A:0683  ad e7 11                           lda vdctab+VCCY_HPOS
  323 A:0686  18                                 clc 
  324 A:0687  6d ed 11                           adc dynhoff
  325 A:068a  18                                 clc 
  326 A:068b  69 03                              adc #3             ; shift three to the right
  327 A:068d  20 43 11                           jsr sreg
  328 A:0690  a2 01                              ldx #VCCY_HDISP
  329 A:0692  a9 3c                              lda #60             ; only 60 chars
  330 A:0694  20 43 11                           jsr sreg
  331 A:0697  a2 1b                              ldx #VCCY_ROW_INC
  332 A:0699  a9 14                              lda #20             ; compensate
  333 A:069b  20 43 11                           jsr sreg

  335 A:069e  a9 22                              lda #VCCY_BRDR_COL
  336 A:06a0  8d 80 e8                           sta VDC
  337 A:06a3  ee 81 e8                           inc VDC+1
  338 A:06a6  60                                 rts 

  340 A:06a7  80 06                    itab      .word idemo5-1
  341 A:06a9  ff 00                              .word 235+20+OFFSET70
  342 A:06ab  00 00                              .word 0

  344 A:06ad  20 20 20 20 20 20 20 ... txt       .asc "           * HORIZONTAL WIDTH AND POSITION"
  345 A:06d7  0d 00                              .asc CR,0
  346 A:06d9                                     .) 

  348 A:06d9                                    ; --------------------

  350 A:06d9                                     .( 
  351 A:06d9                           demohscrl 
  352 A:06d9  a9 20                              lda #<txt
  353 A:06db  a0 07                              ldy #>txt
  354 A:06dd  20 33 12                           jsr txtout

  356 A:06e0  a9 1a                              lda #<itab
  357 A:06e2  a0 07                              ldy #>itab
  358 A:06e4  20 5a 10                           jsr addirq

  360 A:06e7  4c 44 12                           jmp wait

  362 A:06ea                           idemo5    
  363 A:06ea  a2 26                              ldx #VCCY_HPOS
  364 A:06ec  ad e7 11                           lda vdctab+VCCY_HPOS            ; reset shift
  365 A:06ef  18                                 clc 
  366 A:06f0  6d ed 11                           adc dynhoff
  367 A:06f3  20 43 11                           jsr sreg
  368 A:06f6  a2 01                              ldx #VCCY_HDISP
  369 A:06f8  a9 50                              lda #80             ; reset chars to 80
  370 A:06fa  20 43 11                           jsr sreg
  371 A:06fd  a2 1b                              ldx #VCCY_ROW_INC
  372 A:06ff  a9 00                              lda #0             ; reset compensate
  373 A:0701  20 43 11                           jsr sreg

  375 A:0704  a2 19                              ldx #VCCY_HSCRL
  376 A:0706  a5 09                              lda cnt2
  377 A:0708  4a                                 lsr 
  378 A:0709  4a                                 lsr 
  379 A:070a  4a                                 lsr 
  380 A:070b  4a                                 lsr 
  381 A:070c  09 10                              ora #16
  382 A:070e  20 43 11                           jsr sreg

  384 A:0711  a9 22                              lda #VCCY_BRDR_COL
  385 A:0713  8d 80 e8                           sta VDC
  386 A:0716  ee 81 e8                           inc VDC+1
  387 A:0719  60                                 rts 

  389 A:071a  e9 06                    itab      .word idemo5-1
  390 A:071c  11 01                              .word 253+20+OFFSET70
  391 A:071e  00 00                              .word 0

  393 A:0720  20 20 20 20 20 20 20 ... txt       .asc "           * HORIZONTAL SMOOTH SCROLL"
  394 A:0745  0d 00                              .asc CR,0
  395 A:0747                                     .) 

  397 A:0747                                    ; --------------------

  399 A:0747                                     .( 
  400 A:0747                           demoborders 
  401 A:0747  a9 71                              lda #<txt
  402 A:0749  a0 07                              ldy #>txt
  403 A:074b  20 33 12                           jsr txtout

  405 A:074e  a9 6b                              lda #<itab
  406 A:0750  a0 07                              ldy #>itab
  407 A:0752  20 5a 10                           jsr addirq

  409 A:0755  a2 22                              ldx #VCCY_BRDR_COL
  410 A:0757  a9 05                              lda #5
  411 A:0759  20 43 11                           jsr sreg

  413 A:075c  ee e3 11                           inc vdctab+VCCY_BRDR_COL

  415 A:075f  4c 44 12                           jmp wait

  417 A:0762                           idemo5    
  418 A:0762  a9 22                              lda #VCCY_BRDR_COL
  419 A:0764  8d 80 e8                           sta VDC
  420 A:0767  ee 81 e8                           inc VDC+1
  421 A:076a  60                                 rts 

  423 A:076b  61 07                    itab      .word idemo5-1
  424 A:076d  8c 00                              .word 140+OFFSET70
  425 A:076f  00 00                              .word 0

  427 A:0771  0d                       txt       .asc CR
  428 A:0772  20 20 20 20 20 20 20 ...           .asc "           * BORDERS AND RASTERLINE INTERRUPTS"
  429 A:07a0  0d 00                              .asc CR,0
  430 A:07a2                                     .) 

  432 A:07a2                                    ; --------------------

  434 A:07a2                                     .( 
  435 A:07a2  00                       cur       .byt 0

  437 A:07a3                           demovert  
  438 A:07a3  a9 f6                              lda #<txt
  439 A:07a5  a0 07                              ldy #>txt
  440 A:07a7  20 33 12                           jsr txtout

  442 A:07aa  a9 62                              lda #<itab3
  443 A:07ac  a0 08                              ldy #>itab3
  444 A:07ae  20 77 10                           jsr insirq

  446 A:07b1  a9 45                              lda #<itab2
  447 A:07b3  a0 08                              ldy #>itab2
  448 A:07b5  20 77 10                           jsr insirq

  450 A:07b8  a9 f0                              lda #<itab
  451 A:07ba  a0 07                              ldy #>itab
  452 A:07bc  20 77 10                           jsr insirq

  454 A:07bf  a9 78                              lda #<itabres
  455 A:07c1  a0 08                              ldy #>itabres
  456 A:07c3  20 5a 10                           jsr addirq

  458 A:07c6  4c 44 12                           jmp wait

  460 A:07c9                           idemo5    
  461 A:07c9  a2 19                              ldx #VCCY_HSCRL
  462 A:07cb  a9 10                              lda #16
  463 A:07cd  20 43 11                           jsr sreg

  465 A:07d0  a5 09                              lda cnt2
  466 A:07d2  29 e0                              and #%11100000
  467 A:07d4  4a                                 lsr 
  468 A:07d5  4a                                 lsr 
  469 A:07d6  4a                                 lsr 
  470 A:07d7  4a                                 lsr 
  471 A:07d8  4a                                 lsr 
  472 A:07d9  c9 07                              cmp #7
  473 A:07db  90 02                              bcc x1
  474 A:07dd  a9 00                              lda #0
  475 A:07df  8d a2 07                 x1        sta cur

  477 A:07e2  a2 18                              ldx #VCCY_VSCRL
  478 A:07e4  20 43 11                           jsr sreg
  479 A:07e7                                    ;sta $8002
  480 A:07e7                           noinc     
  481 A:07e7  a9 22                              lda #VCCY_BRDR_COL
  482 A:07e9  8d 80 e8                           sta VDC
  483 A:07ec  ee 81 e8                           inc VDC+1
  484 A:07ef  60                                 rts 

  486 A:07f0  c8 07                    itab      .word idemo5-1
  487 A:07f2  02 00                              .word 2+OFFSET70
  488 A:07f4  00 00                              .word 0

  490 A:07f6  20 20 20 20 20 20 20 ... txt       .asc "           * VERTICAL SMOOTH SCROLL + VARIABLE CHAR HEIGHT"
  491 A:0830  0d 00                              .asc CR,0

  493 A:0832                           idemo2    
  494 A:0832  ad a2 07                           lda cur
  495 A:0835  69 07                              adc #7
  496 A:0837  a2 09                              ldx #VCCY_CHEIGHT
  497 A:0839  20 43 11                           jsr sreg

  499 A:083c  a2 22                              ldx #VCCY_BRDR_COL
  500 A:083e  8e 80 e8                           stx VDC
  501 A:0841  ee 81 e8                           inc VDC+1
  502 A:0844  60                                 rts 

  504 A:0845  31 08                    itab2     .word idemo2-1
  505 A:0847  75 00                              .word 117+OFFSET70
  506 A:0849  00 00                              .word 0

  508 A:084b                           idemo3    
  509 A:084b  a2 09                              ldx #VCCY_CHEIGHT
  510 A:084d  a9 08                              lda #8
  511 A:084f  20 43 11                           jsr sreg

  513 A:0852  a2 18                              ldx #VCCY_VSCRL
  514 A:0854  a9 00                              lda #0
  515 A:0856  20 43 11                           jsr sreg

  517 A:0859  a2 22                              ldx #VCCY_BRDR_COL
  518 A:085b  8e 80 e8                           stx VDC
  519 A:085e  ee 81 e8                           inc VDC+1
  520 A:0861  60                                 rts 

  523 A:0862  4a 08                    itab3     .word idemo3-1
  524 A:0864  87 00                              .word 135+OFFSET70
  525 A:0866  00 00                              .word 0

  527 A:0868                           idemores  
  528 A:0868  a2 19                              ldx #VCCY_HSCRL
  529 A:086a  a9 10                              lda #16
  530 A:086c  20 43 11                           jsr sreg
  531 A:086f  a2 22                              ldx #VCCY_BRDR_COL
  532 A:0871  8e 80 e8                           stx VDC
  533 A:0874  ee 81 e8                           inc VDC+1
  534 A:0877  60                                 rts 

  536 A:0878  67 08                    itabres   .word idemores-1
  537 A:087a  23 01                              .word 271+20+OFFSET70
  538 A:087c  00 00                              .word 0

  541 A:087e                                     .) 

  543 A:087e                                    ; --------------------

  545 A:087e                                     .( 
  546 A:087e                           demo4080  
  547 A:087e  a9 b2                              lda #<txt
  548 A:0880  a0 08                              ldy #>txt
  549 A:0882  20 33 12                           jsr txtout

  551 A:0885  a9 ac                              lda #<itab
  552 A:0887  a0 08                              ldy #>itab
  553 A:0889  20 5a 10                           jsr addirq

  555 A:088c  4c 44 12                           jmp wait

  557 A:088f  a2 08                    idemo5    ldx #VCCY_MODE
  558 A:0891  a9 00                              lda #0
  559 A:0893  20 43 11                           jsr sreg

  561 A:0896  a2 01                              ldx #VCCY_HDISP
  562 A:0898  a9 28                              lda #40             ; 40 cols per line
  563 A:089a  20 43 11                           jsr sreg
  564 A:089d  a2 1b                              ldx #VCCY_ROW_INC               ; compensate 40 chars 
  565 A:089f  20 43 11                           jsr sreg

  567 A:08a2  a9 22                              lda #VCCY_BRDR_COL
  568 A:08a4  8d 80 e8                           sta VDC
  569 A:08a7  ee 81 e8                           inc VDC+1
  570 A:08aa  60                                 rts 

  572 A:08ab  60                                 rts 

  574 A:08ac  8e 08                    itab      .word idemo5-1
  575 A:08ae  35 01                              .word 289+20+OFFSET70
  576 A:08b0  00 00                              .word 0

  578 A:08b2  20 20 20 20 20 20 20 ... txt       .asc "           * SWITCHABLE 40/80 COLS"
  579 A:08d4  0d 00                              .asc CR,0
  580 A:08d6                                     .) 

  582 A:08d6                                    ; --------------------

  584 A:08d6                                     .( 
  585 A:08d6                           demo50rows 
  586 A:08d6  a9 ee                              lda #<txt
  587 A:08d8  a0 08                              ldy #>txt
  588 A:08da  20 33 12                           jsr txtout

  590 A:08dd  a9 45                              lda #<itab
  591 A:08df  a0 09                              ldy #>itab
  592 A:08e1  20 5a 10                           jsr addirq

  594 A:08e4  a9 52                              lda #<itab2
  595 A:08e6  a0 09                              ldy #>itab2
  596 A:08e8  20 5a 10                           jsr addirq

  598 A:08eb  4c 44 12                           jmp wait

  600 A:08ee  20 20 20 20 20 20 20 ... txt       .asc "           * 50 ROW MODES - UP TO 88","x"-32,"71 CHARS"
  601 A:091b  0d 00                              .asc CR,0

  603 A:091d                           idemo5    
  604 A:091d  a2 25                              ldx #VCCY_SYNC
  605 A:091f  8e 80 e8                           stx VDC
  606 A:0922  2c 81 e8                 l0        bit VDC+1
  607 A:0925  50 fb                              bvc l0

  609 A:0927  a2 08                              ldx #VCCY_MODE
  610 A:0929  a9 83                              lda #128+3       ; 50x80 mode
  611 A:092b  20 43 11                           jsr sreg

  613 A:092e  a2 01                              ldx #VCCY_HDISP
  614 A:0930  a9 50                              lda #80             ; reset 40 cols per line
  615 A:0932  20 43 11                           jsr sreg
  616 A:0935  a9 00                              lda #0
  617 A:0937  a2 1b                              ldx #VCCY_ROW_INC               ; reset compensate 40 chars 
  618 A:0939  20 43 11                           jsr sreg

  620 A:093c  a9 22                              lda #VCCY_BRDR_COL
  621 A:093e  8d 80 e8                           sta VDC
  622 A:0941  ee 81 e8                           inc VDC+1
  623 A:0944  60                                 rts 

  625 A:0945  1c 09                    itab      .word idemo5-1
  626 A:0947  47 01                              .word 325+2+OFFSET70
  627 A:0949  00 00                              .word 0

  629 A:094b  a2 08                    idemox    ldx #VCCY_MODE
  630 A:094d  a9 80                              lda #128
  631 A:094f  4c 43 11                           jmp sreg

  633 A:0952  4a 09                    itab2     .word idemox-1
  634 A:0954  50 01                              .word 316+20+OFFSET70
  635 A:0956  00 00                              .word 0

  637 A:0958                                     .) 

  639 A:0958                                    ; --------------------
  640 A:0958                                     .( 
  641 A:0958                           democset  
  642 A:0958  a9 1a                              lda #<txt
  643 A:095a  a0 0a                              ldy #>txt
  644 A:095c  20 33 12                           jsr txtout

  646 A:095f  a9 92                              lda #<itab
  647 A:0961  a0 09                              ldy #>itab
  648 A:0963  20 5a 10                           jsr addirq

  650 A:0966  a9 14                              lda #<itab2
  651 A:0968  a0 0a                              ldy #>itab2
  652 A:096a  20 5a 10                           jsr addirq

  654 A:096d  4c 44 12                           jmp wait

  656 A:0970                           idemo5    
  657 A:0970  a2 25                              ldx #VCCY_SYNC
  658 A:0972  8e 80 e8                           stx VDC
  659 A:0975  2c 81 e8                 l         bit VDC+1
  660 A:0978  50 fb                              bvc l

  662 A:097a  a2 08                              ldx #VCCY_MODE
  663 A:097c  a9 80                              lda #128             ; 25x80 mode
  664 A:097e  20 43 11                           jsr sreg

  666 A:0981  a2 09                              ldx #VCCY_CHEIGHT
  667 A:0983  a9 0b                              lda #11             ; 12 rasterlines/char
  668 A:0985  20 43 11                           jsr sreg

  670 A:0988  a9 22                              lda #VCCY_BRDR_COL
  671 A:098a  8d 80 e8                           sta VDC
  672 A:098d  ee 81 e8                           inc VDC+1
  673 A:0990  60                                 rts 

  675 A:0991  00                       mode      .byt 0

  677 A:0992  6f 09                    itab      .word idemo5-1
  678 A:0994  59 01                              .word 325+20+OFFSET70
  679 A:0996  00 00                              .word 0

  681 A:0998  a2 09                    idemox    ldx #VCCY_CHEIGHT
  682 A:099a  a9 08                              lda #8             ; 9 rasterlines/char
  683 A:099c  20 43 11                           jsr sreg

  685 A:099f  a5 09                              lda cnt2
  686 A:09a1  29 0f                              and #15
  687 A:09a3  d0 66                              bne end

  689 A:09a5  ac 91 09                           ldy mode
  690 A:09a8  d0 26                              bne mode1

  692 A:09aa                           mode0     .( 
  693 A:09aa                                    ; scroll a single char
  694 A:09aa  a2 0f                              ldx #VCCY_CRSR_POS_L
  695 A:09ac  bf 30 00 08                        lda CHAR,x
  696 A:09b0  48                                 pha 

  698 A:09b1  ca                       l0        dex 
  699 A:09b2  bf 30 00 08                        lda CHAR,x
  700 A:09b6  4a                                 lsr 
  701 A:09b7  90 02                              bcc l1
  702 A:09b9  09 80                              ora #$80
  703 A:09bb  e8                       l1        inx 
  704 A:09bc  9f 30 00 08                        sta CHAR,x
  705 A:09c0  ca                                 dex 
  706 A:09c1  d0 ee                              bne l0

  708 A:09c3  68                                 pla 
  709 A:09c4  4a                                 lsr 
  710 A:09c5  90 02                              bcc l2
  711 A:09c7  09 80                              ora #$80
  712 A:09c9  9f 30 00 08              l2        sta CHAR,x
  713 A:09cd  4c f5 09                           jmp checkmode
  714 A:09d0                                     .) 
  715 A:09d0                           mode1     .( 
  716 A:09d0                                    ; R22/R23 horizontal/vertical displayed pixel per char
  717 A:09d0  a5 09                              lda cnt2
  718 A:09d2  4a                                 lsr 
  719 A:09d3  4a                                 lsr 
  720 A:09d4  4a                                 lsr 
  721 A:09d5  4a                                 lsr 
  722 A:09d6  88                                 dey 
  723 A:09d7  d0 14                              bne m                ; mode2, jump r23
  724 A:09d9  a2 16                              ldx #VCCY_CHR_HDISP
  725 A:09db  85 06                              sta tmp
  726 A:09dd  a9 0f                              lda #15
  727 A:09df  38                                 sec 
  728 A:09e0  e5 06                              sbc tmp
  729 A:09e2  d0 0e                              bne store
  730 A:09e4  a9 01                              lda #1
  731 A:09e6  8d d8 11                           sta vdctab+VCCY_CHR_VDISP            ; initialize next mode
  732 A:09e9  a9 08                              lda #8
  733 A:09eb  d0 05                              bne store

  735 A:09ed  a2 17                    m         ldx #VCCY_CHR_VDISP
  736 A:09ef  18                                 clc 
  737 A:09f0  69 01                              adc #1
  738 A:09f2  9d c1 11                 store     sta vdctab,x
  739 A:09f5                                     .) 
  740 A:09f5                           checkmode .( 
  741 A:09f5  a5 09                              lda cnt2
  742 A:09f7  29 f0                              and #$f0
  743 A:09f9  49 f0                              eor #$f0
  744 A:09fb  d0 0e                              bne end
  745 A:09fd  ee 91 09                           inc mode
  746 A:0a00  ad 91 09                           lda mode
  747 A:0a03  38                                 sec 
  748 A:0a04  e9 03                              sbc #3
  749 A:0a06  d0 03                              bne end
  750 A:0a08  8d 91 09                           sta mode
  751 A:0a0b                                     .) 

  753 A:0a0b                           end       
  754 A:0a0b  a9 22                              lda #VCCY_BRDR_COL
  755 A:0a0d  8d 80 e8                           sta VDC
  756 A:0a10  ee 81 e8                           inc VDC+1
  757 A:0a13  60                                 rts 

  760 A:0a14  97 09                    itab2     .word idemox-1
  761 A:0a16  61 01                              .word 353+OFFSET70
  762 A:0a18  00 00                              .word 0

  764 A:0a1a  20 20 20 20 20 20 20 ... txt       .asc "           * RE-DEFINABLE CHARACTER SET, LARGE HEIGHT AND CUT-OFF"
  765 A:0a5b  0d 00                              .asc CR,0
  766 A:0a5d                                     .) 

  768 A:0a5d                                    ; --------------------

  770 A:0a5d                                    ; must be last, as it starts hires
  771 A:0a5d                                     .( 
  772 A:0a5d                           demohires 
  773 A:0a5d  a9 6f                              lda #<txt
  774 A:0a5f  a0 0a                              ldy #>txt
  775 A:0a61  20 33 12                           jsr txtout

  777 A:0a64  a9 01                              lda #1
  778 A:0a66  8d b2 0a                           sta resmode
  779 A:0a69  8d b3 0a                           sta rescnt

  781 A:0a6c  4c 44 12                           jmp wait

  783 A:0a6f  20 20 20 20 20 20 20 ... txt       .asc "           * HIRES (SINGLE COLOUR, ATTRIBUTE, FG/BG, MULTI) MODES"
  784 A:0ab0  0d 00                              .asc CR,0
  785 A:0ab2                                     .) 
  786 A:0ab2                                    ; --------------------

  788 A:0ab2                                    ; starts split screen mode

  790 A:0ab2  00                       resmode   .byt 0
  791 A:0ab3  00                       rescnt    .byt 0

  793 A:0ab4  00                       resfl     .byt 0

  795 A:0ab5                                     .( 
  796 A:0ab5  00                       cur       .byt 0

  798 A:0ab6                           demoreset 
  799 A:0ab6  a9 00                              lda #0
  800 A:0ab8  8d b2 0a                           sta resmode
  801 A:0abb  8d b3 0a                           sta rescnt

  803 A:0abe  a9 84                              lda #<txt
  804 A:0ac0  a0 0c                              ldy #>txt
  805 A:0ac2  20 33 12                           jsr txtout

  807 A:0ac5  a9 4f                              lda #<itab
  808 A:0ac7  a0 0c                              ldy #>itab
  809 A:0ac9  20 5a 10                           jsr addirq

  811 A:0acc  a9 7e                              lda #<itabc
  812 A:0ace  a0 0c                              ldy #>itabc
  813 A:0ad0  20 5a 10                           jsr addirq

  815 A:0ad3                                    ; set hires buffer
  816 A:0ad3  08                                 php 
  817 A:0ad4  78                                 sei 

  819 A:0ad5                                    ; go to native / wide mode
  820 A:0ad5  18                                 clc 
  821 A:0ad6  fb                                 xce 
  822 A:0ad7                                    ; set X/Y registers to 16 bit ...
  823 A:0ad7  c2 10                              rep #%00010000
  824 A:0ad9                                     .xl 

  826 A:0ad9  a9 00                              lda #0
  827 A:0adb  a2 ff 1f                           ldx #$1fff
  828 A:0ade  9f 00 40 08              l3        sta $084000,x
  829 A:0ae2                                    ;txa
  830 A:0ae2  ca                                 dex 
  831 A:0ae3  d0 f9                              bne l3

  833 A:0ae5  c2 30                              rep #%00110000
  834 A:0ae7                                     .al 

  836 A:0ae7  a9 00 00                           lda #$00             ; value
  837 A:0aea  48                       l2        pha 
  838 A:0aeb                                    ; times 80=64+16 to get top down bytes
  839 A:0aeb  0a                                 asl 
  840 A:0aec  0a                                 asl 
  841 A:0aed  0a                                 asl 
  842 A:0aee  0a                                 asl 
  843 A:0aef  85 06                              sta tmp                ; x16
  844 A:0af1  0a                                 asl 
  845 A:0af2  0a                                 asl                    ; x64
  846 A:0af3  18                                 clc 
  847 A:0af4  65 06                              adc tmp                ; x80
  848 A:0af6  aa                                 tax 
  849 A:0af7  68                                 pla 
  850 A:0af8  9f 14 40 08                        sta $084014,x
  851 A:0afc  9f 16 40 08                        sta $084016,x
  852 A:0b00  9f 18 40 08                        sta $084018,x
  853 A:0b04  9f 1a 40 08                        sta $08401a,x
  854 A:0b08  18                                 clc 
  855 A:0b09  69 01 00                           adc #1
  856 A:0b0c  c9 80 00                           cmp #$80
  857 A:0b0f  90 d9                              bcc l2

  859 A:0b11                                    ; draw a line
  860 A:0b11  a9 00 00                           lda #0
  861 A:0b14  aa                       :           tax 
  862 A:0b15  a8                                 tay 
  863 A:0b16  48                                 pha 
  864 A:0b17  20 43 0b                           jsr dot_wxa
  865 A:0b1a  68                                 pla 
  866 A:0b1b  48                                 pha 
  867 A:0b1c  18                                 clc 
  868 A:0b1d                                    ;adc #128
  869 A:0b1d  aa                                 tax 
  870 A:0b1e  68                                 pla 
  871 A:0b1f  48                                 pha 
  872 A:0b20  38                                 sec 
  873 A:0b21  e9 80 00                           sbc #128
  874 A:0b24  49 ff ff                           eor #$ffff
  875 A:0b27  a8                                 tay 
  876 A:0b28  20 43 0b                           jsr dot_wxa
  877 A:0b2b  68                                 pla 
  878 A:0b2c  18                                 clc 
  879 A:0b2d  69 01 00                           adc #1
  880 A:0b30  c9 80 00                           cmp #128
  881 A:0b33  90 df                              bcc :-

  883 A:0b35                                    ; end native / wide mode
  884 A:0b35  a9 00 00                           lda #0
  885 A:0b38  a2 00 00                           ldx #0
  886 A:0b3b  e2 30                              sep #%00110000

  888 A:0b3d  38                                 sec 
  889 A:0b3e  fb                                 xce 

  891 A:0b3f                                     .xs 
  892 A:0b3f                                     .as 
  893 A:0b3f  28                                 plp 

  895 A:0b40  4c 44 12                           jmp wait

  897 A:0b43                                     .al 
  898 A:0b43                                     .xl 

  900 A:0b43                           dot_wxa                    ; draw a hires dot on x/y
  901 A:0b43  98                                 tya 
  902 A:0b44  0a                                 asl 
  903 A:0b45  0a                                 asl 
  904 A:0b46  0a                                 asl 
  905 A:0b47  0a                                 asl                    ; x16
  906 A:0b48  85 06                              sta tmp
  907 A:0b4a  0a                                 asl 
  908 A:0b4b  0a                                 asl                    ; x64
  909 A:0b4c  18                                 clc 
  910 A:0b4d  65 06                              adc tmp
  911 A:0b4f  85 06                              sta tmp
  912 A:0b51  8a                                 txa 
  913 A:0b52  4a                                 lsr 
  914 A:0b53  4a                                 lsr 
  915 A:0b54  4a                                 lsr 
  916 A:0b55  29 fe 00                           and #$fe             ; index in line
  917 A:0b58  18                                 clc 
  918 A:0b59  65 06                              adc tmp
  919 A:0b5b  85 06                              sta tmp
  920 A:0b5d  8a                                 txa 
  921 A:0b5e  29 0f 00                           and #$0f             ; index in word
  922 A:0b61  0a                                 asl 
  923 A:0b62  a8                                 tay 
  924 A:0b63  b9 71 0b                           lda dottab,y
  925 A:0b66  a6 06                              ldx tmp
  926 A:0b68  1f 20 40 08                        ora $084020,x
  927 A:0b6c  9f 20 40 08                        sta $084020,x
  928 A:0b70  60                                 rts 

  930 A:0b71  80 00                    dottab    .word $80
  931 A:0b73  40 00                              .word $40
  932 A:0b75  20 00                              .word $20
  933 A:0b77  10 00                              .word $10
  934 A:0b79  08 00                              .word $08
  935 A:0b7b  04 00                              .word $04
  936 A:0b7d  02 00                              .word $02
  937 A:0b7f  01 00                              .word $01
  938 A:0b81  00 80                              .word $8000
  939 A:0b83  00 40                              .word $4000
  940 A:0b85  00 20                              .word $2000
  941 A:0b87  00 10                              .word $1000
  942 A:0b89  00 08                              .word $0800
  943 A:0b8b  00 04                              .word $0400
  944 A:0b8d  00 02                              .word $0200
  945 A:0b8f  00 01                              .word $0100

  947 A:0b91                                     .as 
  948 A:0b91                                     .xs 

  950 A:0b91                           idemo5                     ; if alt registers are set during raster match, they are effective in the next rasterline already!
  951 A:0b91  a2 28                              ldx #VCCY_ALT1
  952 A:0b93  a9 01                              lda #1
  953 A:0b95  20 43 11                           jsr sreg

  955 A:0b98  ad b2 0a                           lda resmode
  956 A:0b9b  f0 3e                              beq text

  958 A:0b9d  ac b3 0a                           ldy rescnt
  959 A:0ba0  f0 39                              beq text

  961 A:0ba2                           hres1     
  962 A:0ba2  a2 0c                              ldx #VCCY_MEM_STRT_H
  963 A:0ba4  a9 40                              lda #>$4000
  964 A:0ba6  20 43 11                           jsr sreg
  965 A:0ba9  e8                                 inx 
  966 A:0baa  a9 00                              lda #<$4000
  967 A:0bac  20 43 11                           jsr sreg

  969 A:0baf  a2 14                              ldx #VCCY_ATT_STRT_H
  970 A:0bb1  a9 d1                              lda #>$d000+5*80
  971 A:0bb3  20 43 11                           jsr sreg
  972 A:0bb6  e8                                 inx 
  973 A:0bb7  a9 90                              lda #<$d000+5*80
  974 A:0bb9  20 43 11                           jsr sreg

  976 A:0bbc  88                                 dey 
  977 A:0bbd  d0 0a                              bne hres2

  979 A:0bbf  a9 e2                              lda #128+64+32+2
  980 A:0bc1  a2 28                    set       ldx #VCCY_ALT1
  981 A:0bc3  20 43 11                           jsr sreg                ; disable ColourPet mode

  983 A:0bc6  4c ff 0b                           jmp common

  985 A:0bc9  88                       hres2     dey 
  986 A:0bca  d0 04                              bne hres3

  988 A:0bcc  a9 e6                              lda #128+64+32+4+2
  989 A:0bce  d0 f1                              bne set

  991 A:0bd0  88                       hres3     dey 
  992 A:0bd1  d0 04                              bne hres4

  994 A:0bd3  a9 ea                              lda #128+64+32+8+2
  995 A:0bd5  d0 ea                              bne set

  997 A:0bd7  a9 ee                    hres4     lda #128+64+32+8+4+2
  998 A:0bd9  d0 e6                              bne set

 1000 A:0bdb                           text      
 1001 A:0bdb  a2 0c                              ldx #VCCY_MEM_STRT_H
 1002 A:0bdd  a9 91                              lda #>$9000+5*80
 1003 A:0bdf  20 43 11                           jsr sreg
 1004 A:0be2  e8                                 inx 
 1005 A:0be3  a9 90                              lda #<$9000+5*80
 1006 A:0be5  20 43 11                           jsr sreg

 1008 A:0be8  a2 14                              ldx #VCCY_ATT_STRT_H
 1009 A:0bea  a9 d1                              lda #>$d000+5*80
 1010 A:0bec  20 43 11                           jsr sreg
 1011 A:0bef  e8                                 inx 
 1012 A:0bf0  a9 90                              lda #<$d000+5*80
 1013 A:0bf2  20 43 11                           jsr sreg

 1015 A:0bf5  a2 28                              ldx #VCCY_ALT1
 1016 A:0bf7  a9 e8                              lda #128+64+32+8
 1017 A:0bf9  20 43 11                           jsr sreg                ; disable ColourPet mode

 1019 A:0bfc  4c ff 0b                           jmp common

 1021 A:0bff                           common    
 1022 A:0bff  a9 80                              lda #128
 1023 A:0c01  a2 29                              ldx #VCCY_ALT2
 1024 A:0c03  20 43 11                           jsr sreg

 1026 A:0c06  ad b2 0a                           lda resmode
 1027 A:0c09  f0 19                              beq noinc
 1028 A:0c0b  a5 09                              lda cnt2
 1029 A:0c0d  d0 15                              bne noinc
 1030 A:0c0f  a5 08                              lda cnt
 1031 A:0c11  29 01                              and #1
 1032 A:0c13  d0 0f                              bne noinc

 1034 A:0c15  ee b3 0a                           inc rescnt
 1035 A:0c18  ad b3 0a                           lda rescnt
 1036 A:0c1b  c9 05                              cmp #5
 1037 A:0c1d  90 05                              bcc noinc
 1038 A:0c1f  a9 00                              lda #0
 1039 A:0c21  8d b3 0a                           sta rescnt
 1040 A:0c24                           noinc     

 1042 A:0c24  a5 08                              lda cnt
 1043 A:0c26  4a                                 lsr 
 1044 A:0c27  a5 09                              lda cnt2
 1045 A:0c29  6a                                 ror 
 1046 A:0c2a  4a                                 lsr 
 1047 A:0c2b  c9 52                              cmp #82
 1048 A:0c2d  90 02                              bcc l1
 1049 A:0c2f  a9 52                              lda #82
 1050 A:0c31  8d b5 0a                 l1        sta cur
 1051 A:0c34  a9 f4                              lda #<500+OFFSET70
 1052 A:0c36  38                                 sec 
 1053 A:0c37  ed b5 0a                           sbc cur
 1054 A:0c3a  09 01                              ora #1             ; that prevents the top line from flickering, as we are in non-interlace mode
 1055 A:0c3c  8d 51 0c                           sta line
 1056 A:0c3f  a9 01                              lda #>500+OFFSET70
 1057 A:0c41  e9 00                              sbc #0
 1058 A:0c43  8d 52 0c                           sta line+1

 1060 A:0c46  a9 22                              lda #VCCY_BRDR_COL
 1061 A:0c48  8d 80 e8                           sta VDC
 1062 A:0c4b  ee 81 e8                           inc VDC+1

 1064 A:0c4e  60                                 rts 

 1066 A:0c4f  90 0b                    itab      .word idemo5-1
 1067 A:0c51  94 01                    line      .word 404+OFFSET70
 1068 A:0c53  00 00                              .word 0

 1070 A:0c55                           iclr      
 1071 A:0c55  a2 28                              ldx #VCCY_ALT1
 1072 A:0c57  a9 00                              lda #0
 1073 A:0c59  20 43 11                           jsr sreg

 1075 A:0c5c  a2 29                              ldx #VCCY_ALT2
 1076 A:0c5e  a9 00                              lda #0
 1077 A:0c60  20 43 11                           jsr sreg

 1079 A:0c63  ad b5 0a                           lda cur
 1080 A:0c66  18                                 clc 
 1081 A:0c67  69 00                              adc #0
 1082 A:0c69  a8                       l0        tay 
 1083 A:0c6a  38                                 sec 
 1084 A:0c6b  e9 09                              sbc #9
 1085 A:0c6d  b0 fa                              bcs l0
 1086 A:0c6f  98                                 tya 
 1087 A:0c70  4a                                 lsr 
 1088 A:0c71  09 10                              ora #16
 1089 A:0c73  a2 18                              ldx #VCCY_VSCRL
 1090 A:0c75                                    ; jsr sreg

 1092 A:0c75  a9 22                              lda #VCCY_BRDR_COL
 1093 A:0c77  8d 80 e8                           sta VDC
 1094 A:0c7a  ee 81 e8                           inc VDC+1
 1095 A:0c7d  60                                 rts 

 1097 A:0c7e  54 0c                    itabc     .word iclr-1
 1098 A:0c80  f9 01                              .word 505+OFFSET70
 1099 A:0c82  00 00                              .word 0

 1101 A:0c84  20 20 20 20 20 20 20 ... txt       .asc "           * RESETABLE ADDRESS COUNTERS/PALETTE ON RASTERLINE MATCH"
 1102 A:0cc7  0d 00                              .asc CR,0
 1103 A:0cc9                                     .) 

 1105 A:0cc9                                    ; ---------------------------------------------------------
 1106 A:0cc9                                    ; sprite demo

 1108 A:0cc9                                     .( 
 1109 A:0cc9                           demosprites 
 1110 A:0cc9  a9 b8                              lda #<txt
 1111 A:0ccb  a0 0d                              ldy #>txt
 1112 A:0ccd  20 33 12                           jsr txtout

 1114 A:0cd0                                     .( 
 1115 A:0cd0  a2 3f                              ldx #63             ; sprite data
 1116 A:0cd2  bd f8 0d                 l         lda s_balloon,x
 1117 A:0cd5  9f c0 8f 08                        sta $089000-64,x
 1118 A:0cd9  ca                                 dex 
 1119 A:0cda  10 f6                              bpl l
 1120 A:0cdc                                     .) 

 1122 A:0cdc                                    ; alternate palette for the sprite
 1123 A:0cdc                                     .( 
 1124 A:0cdc                                    ; enable access to alternate palette
 1125 A:0cdc  a2 28                              ldx #VCCY_ALT1
 1126 A:0cde  a9 01                              lda #1
 1127 A:0ce0  20 43 11                           jsr sreg

 1129 A:0ce3                                    ; access first half of the palette
 1130 A:0ce3  a2 20                              ldx #VCCY_CTRL
 1131 A:0ce5  8e 80 e8                           stx VDC
 1132 A:0ce8  ad 81 e8                           lda VDC+1
 1133 A:0ceb  29 df                              and #%11011111
 1134 A:0ced  8d 81 e8                           sta VDC+1

 1136 A:0cf0                                    ; first half of palette
 1137 A:0cf0  a9 58                              lda #VCCY_PAL_BASE
 1138 A:0cf2  8d 80 e8                           sta VDC
 1139 A:0cf5  a2 00                              ldx #0
 1140 A:0cf7  bd 37 0e                 l         lda sprite_pal,x
 1141 A:0cfa  8d 83 e8                           sta VDC+3
 1142 A:0cfd  e8                                 inx 
 1143 A:0cfe  e0 08                              cpx #8
 1144 A:0d00  90 f5                              bcc l

 1146 A:0d02                                    ; access second half of the palette
 1147 A:0d02  a9 20                              lda #VCCY_CTRL
 1148 A:0d04  8d 80 e8                           sta VDC
 1149 A:0d07  ad 81 e8                           lda VDC+1
 1150 A:0d0a  09 20                              ora #%00100000
 1151 A:0d0c  8d 81 e8                           sta VDC+1

 1153 A:0d0f                                    ; second half of palette
 1154 A:0d0f  a9 58                              lda #VCCY_PAL_BASE
 1155 A:0d11  8d 80 e8                           sta VDC
 1156 A:0d14  bd 37 0e                 l2        lda sprite_pal,x
 1157 A:0d17  8d 83 e8                           sta VDC+3
 1158 A:0d1a  e8                                 inx 
 1159 A:0d1b  e0 10                              cpx #16
 1160 A:0d1d  90 f5                              bcc l2

 1162 A:0d1f                                    ; access first half of the palette again
 1163 A:0d1f  a9 20                              lda #VCCY_CTRL
 1164 A:0d21  8d 80 e8                           sta VDC
 1165 A:0d24  ad 81 e8                           lda VDC+1
 1166 A:0d27  29 df                              and #%11011111
 1167 A:0d29  8d 81 e8                           sta VDC+1

 1169 A:0d2c                                    ; restore normal registers
 1170 A:0d2c  a2 28                              ldx #VCCY_ALT1
 1171 A:0d2e  a9 00                              lda #0
 1172 A:0d30  20 43 11                           jsr sreg
 1173 A:0d33                                     .) 

 1175 A:0d33  a9 3f                              lda #63
 1176 A:0d35  8d f8 87                           sta $8800-8        ; sprite pointer

 1178 A:0d38  a2 30                              ldx #VCCY_SPRT_BASE_0+SPRT_XPOS           ; x-pos
 1179 A:0d3a  a9 28                              lda #40
 1180 A:0d3c  20 43 11                           jsr sreg

 1182 A:0d3f  e8                                 inx                    ; y-pos
 1183 A:0d40  a9 c8                              lda #200
 1184 A:0d42  20 43 11                           jsr sreg

 1186 A:0d45  e8                                 inx                    ; x/y high bits
 1187 A:0d46  a9 00                              lda #0
 1188 A:0d48  20 43 11                           jsr sreg

 1190 A:0d4b  a2 50                              ldx #VCCY_SPRT_COL_0
 1191 A:0d4d  a9 05                              lda #5
 1192 A:0d4f  20 43 11                           jsr sreg                ; fg colour

 1194 A:0d52  a2 2e                              ldx #VCCY_SPRT_MCOL1
 1195 A:0d54  a9 03                              lda #3             ; mcol1
 1196 A:0d56  20 43 11                           jsr sreg
 1197 A:0d59  e8                                 inx 
 1198 A:0d5a  a9 09                              lda #9             ; mcol2
 1199 A:0d5c  20 43 11                           jsr sreg

 1201 A:0d5f  a2 33                              ldx #VCCY_SPRT_BASE_0+SPRT_CTRL
 1202 A:0d61  a9 e7                              lda #1+2+4+32+64+128; enable, x+y-expand, over border, fine coords, alt palette
 1203 A:0d63  20 43 11                           jsr sreg

 1205 A:0d66  a9 b2                              lda #<itab
 1206 A:0d68  a0 0d                              ldy #>itab
 1207 A:0d6a  20 5a 10                           jsr addirq

 1209 A:0d6d  4c 44 12                           jmp wait

 1211 A:0d70                           idemo     
 1212 A:0d70  a5 09                              lda cnt2
 1213 A:0d72  29 01                              and #$01
 1214 A:0d74  d0 33                              bne end

 1216 A:0d76  a2 30                              ldx #VCCY_SPRT_BASE_0+SPRT_XPOS
 1217 A:0d78  8e 80 e8                           stx VDC
 1218 A:0d7b  ee 81 e8                           inc VDC+1
 1219 A:0d7e  d0 18                              bne y

 1221 A:0d80  a2 32                              ldx #VCCY_SPRT_BASE_0+SPRT_XYPOS
 1222 A:0d82  8e 80 e8                           stx VDC
 1223 A:0d85  ad 81 e8                           lda VDC+1
 1224 A:0d88  18                                 clc 
 1225 A:0d89  69 01                              adc #1
 1226 A:0d8b  29 33                              and #%00110011
 1227 A:0d8d  8d 81 e8                           sta VDC+1

 1229 A:0d90  a2 50                              ldx #VCCY_SPRT_COL_0
 1230 A:0d92  8e 80 e8                           stx VDC
 1231 A:0d95  ee 81 e8                           inc VDC+1
 1232 A:0d98                           y         
 1233 A:0d98                                    ; ldx #49
 1234 A:0d98                                    ; stx VDC
 1235 A:0d98                                    ; inc VDC+1
 1236 A:0d98                                    ; bne multi

 1238 A:0d98                                    ; ldx #80
 1239 A:0d98                                    ; stx VDC
 1240 A:0d98                                    ; inc VDC+1
 1241 A:0d98  a5 09                    multi     lda cnt2
 1242 A:0d9a  d0 0d                              bne end
 1243 A:0d9c  a2 33                              ldx #VCCY_SPRT_BASE_0+SPRT_CTRL
 1244 A:0d9e  8e 80 e8                           stx VDC
 1245 A:0da1  ad 81 e8                           lda VDC+1
 1246 A:0da4  49 08                              eor #8             ; multicolour bit
 1247 A:0da6  8d 81 e8                           sta VDC+1
 1248 A:0da9                           end       
 1249 A:0da9  a9 22                              lda #VCCY_BRDR_COL
 1250 A:0dab  8d 80 e8                           sta VDC
 1251 A:0dae  ee 81 e8                           inc VDC+1
 1252 A:0db1  60                                 rts 

 1254 A:0db2  6f 0d                    itab      .word idemo-1
 1255 A:0db4  0d 02                              .word 525+OFFSET70
 1256 A:0db6  00 00                              .word 0

 1258 A:0db8  20 20 20 20 20 20 20 ... txt       .asc "           * SPRITES (SINGLE/MULTICOL,EXPAND,PRIO,ALT PALETTE)"
 1259 A:0df6  0d 00                              .asc CR,0

 1261 A:0df8                           s_balloon 
 1262 A:0df8  00 7f 00 01 ff c0 03 ...           .byt 0,127,0,1,255,192,3,255,224,3,231,224
 1263 A:0e04  07 d9 f0 07 df f0 07 ...           .byt 7,217,240,7,223,240,7,217,240,3,231,224
 1264 A:0e10  03 ff e0 03 ff e0 02 ...           .byt 3,255,224,3,255,224,2,255,160,1,127,64
 1265 A:0e1c  01 3e 40 00 9c 80 00 ...           .byt 1,62,64,0,156,128,0,156,128,0,73,0,0,73,0
 1266 A:0e2b  00 3e 00 00 3e 00 00 ...           .byt 0,62,0,0,62,0,0,62,0,0,28,0
 1267 A:0e37                                     .) 

 1269 A:0e37                           sprite_pal 
 1270 A:0e37  00                                 .byt %00000000
 1271 A:0e38  49                                 .byt %01001001
 1272 A:0e39  02                                 .byt %00000010
 1273 A:0e3a  4b                                 .byt %01001011
 1274 A:0e3b  08                                 .byt %00001000
 1275 A:0e3c  18                                 .byt %00011000
 1276 A:0e3d  09                                 .byt %00001001
 1277 A:0e3e  5b                                 .byt %01011011

 1279 A:0e3f  40                                 .byt %01000000
 1280 A:0e40  c0                                 .byt %11000000
 1281 A:0e41  41                                 .byt %01000001
 1282 A:0e42  cb                                 .byt %11001011
 1283 A:0e43  48                                 .byt %01001000
 1284 A:0e44  d9                                 .byt %11011001
 1285 A:0e45  92                                 .byt %10010010
 1286 A:0e46  ff                                 .byt %11111111

 1288 A:0e47                                    ; ---------------------------------------------------------
 1289 A:0e47                                    ; palette demo

 1291 A:0e47                                     .( 

 1293 A:0e47                           demopalette 
 1294 A:0e47  a9 b3                              lda #<txt
 1295 A:0e49  a0 0e                              ldy #>txt
 1296 A:0e4b  20 33 12                           jsr txtout

 1298 A:0e4e  a9 e9                              lda #<itab
 1299 A:0e50  a0 0e                              ldy #>itab
 1300 A:0e52  20 5a 10                           jsr addirq

 1302 A:0e55  4c 44 12                           jmp wait

 1304 A:0e58                           idemo     
 1305 A:0e58  a5 09                              lda cnt2
 1306 A:0e5a  29 3f                              and #%00111111
 1307 A:0e5c  d0 4c                              bne end

 1309 A:0e5e  a5 09                              lda cnt2
 1310 A:0e60  29 c0                              and #%11000000
 1311 A:0e62  4a                                 lsr 
 1312 A:0e63  4a                                 lsr 
 1313 A:0e64  a8                                 tay 

 1315 A:0e65  a2 20                              ldx #VCCY_CTRL
 1316 A:0e67  8e 80 e8                           stx VDC
 1317 A:0e6a  ad 81 e8                           lda VDC+1
 1318 A:0e6d                                    ;and #%11011111
 1319 A:0e6d  29 df                              and #$ff-VCCY_CTRL_PALSEL
 1320 A:0e6f  8d 81 e8                           sta VDC+1
 1321 A:0e72  48                                 pha 

 1324 A:0e73  a2 58                              ldx #VCCY_PAL_BASE
 1325 A:0e75  8e 80 e8                           stx VDC
 1326 A:0e78  a2 08                              ldx #8
 1327 A:0e7a  b9 ef 0e                 l1        lda pal0,y
 1328 A:0e7d  8d 83 e8                           sta VDC+3          ; includes index increment
 1329 A:0e80  c8                                 iny 
 1330 A:0e81  ca                                 dex 
 1331 A:0e82  d0 f6                              bne l1

 1333 A:0e84  a2 20                              ldx #VCCY_CTRL
 1334 A:0e86  8e 80 e8                           stx VDC
 1335 A:0e89  68                                 pla 
 1336 A:0e8a  48                                 pha 
 1337 A:0e8b  09 20                              ora #VCCY_CTRL_PALSEL               ;%00100000
 1338 A:0e8d  8d 81 e8                           sta VDC+1

 1341 A:0e90  a2 58                              ldx #VCCY_PAL_BASE
 1342 A:0e92  8e 80 e8                           stx VDC
 1343 A:0e95  a2 08                              ldx #8
 1344 A:0e97  b9 ef 0e                 l2        lda pal0,y
 1345 A:0e9a  8d 83 e8                           sta VDC+3          ; includes index increment
 1346 A:0e9d  c8                                 iny 
 1347 A:0e9e  ca                                 dex 
 1348 A:0e9f  d0 f6                              bne l2

 1350 A:0ea1  a2 20                              ldx #VCCY_CTRL
 1351 A:0ea3  8e 80 e8                           stx VDC
 1352 A:0ea6  68                                 pla 
 1353 A:0ea7  8d 81 e8                           sta VDC+1

 1355 A:0eaa                           end       
 1356 A:0eaa  a9 22                              lda #VCCY_BRDR_COL
 1357 A:0eac  8d 80 e8                           sta VDC
 1358 A:0eaf  ee 81 e8                           inc VDC+1
 1359 A:0eb2  60                                 rts 

 1361 A:0eb3  20 20 20 20 20 20 20 ... txt       .asc "           * DUAL PALETTE FOR 2*16 OUT OF 64 COLOURS"
 1362 A:0ee7  0d 00                              .asc CR,0

 1364 A:0ee9  57 0e                    itab      .word idemo-1
 1365 A:0eeb  10 02                              .word 528+OFFSET70
 1366 A:0eed  00 00                              .word 0

 1369 A:0eef  00 49 02 6f              pal0      .byt %00000000,%01001001,%00000010,%01101111
 1370 A:0ef3  0c 7d 0d 7f                        .byt %00001100,%01111101,%00001101,%01111111
 1371 A:0ef7  60 ed 61 ef                        .byt %01100000,%11101101,%01100001,%11101111
 1372 A:0efb  6c fd 92 ff                        .byt %01101100,%11111101,%10010010,%11111111

 1374 A:0eff  00 48 00 6c              pal1      .byt %00000000,%01001000,%00000000,%01101100
 1375 A:0f03  0c 7c 0c 7c                        .byt %00001100,%01111100,%00001100,%01111100
 1376 A:0f07  60 ec 60 ec                        .byt %01100000,%11101100,%01100000,%11101100
 1377 A:0f0b  6c fc 90 fc                        .byt %01101100,%11111100,%10010000,%11111100

 1379 A:0f0f  00 41 02 63              pal2      .byt %00000000,%01000001,%00000010,%01100011
 1380 A:0f13  00 61 01 63                        .byt %00000000,%01100001,%00000001,%01100011
 1381 A:0f17  60 e1 61 e3                        .byt %01100000,%11100001,%01100001,%11100011
 1382 A:0f1b  60 e1 82 e3                        .byt %01100000,%11100001,%10000010,%11100011

 1384 A:0f1f  00 09 02 0f              pal3      .byt %00000000,%00001001,%00000010,%00001111
 1385 A:0f23  0c 1d 0d 1f                        .byt %00001100,%00011101,%00001101,%00011111
 1386 A:0f27  00 0d 01 0f                        .byt %00000000,%00001101,%00000001,%00001111
 1387 A:0f2b  0c 1d 12 1f                        .byt %00001100,%00011101,%00010010,%00011111

 1389 A:0f2f                                     .) 

 1391 A:0f2f                                    ; ---------------------------------------------------------
 1392 A:0f2f                                    ; dynamic position demo

 1394 A:0f2f                                     .( 

 1396 A:0f2f                           demodynpos 
 1397 A:0f2f  a9 bd                              lda #<txt
 1398 A:0f31  a0 0f                              ldy #>txt
 1399 A:0f33  20 33 12                           jsr txtout

 1401 A:0f36  a9 e3                              lda #<itab
 1402 A:0f38  a0 0f                              ldy #>itab
 1403 A:0f3a  20 5a 10                           jsr addirq

 1405 A:0f3d  4c 44 12                           jmp wait

 1407 A:0f40                           idemo     
 1408 A:0f40  a5 09                              lda cnt2
 1409 A:0f42  29 0f                              and #%00001111
 1410 A:0f44  d0 3a                              bne checkh

 1412 A:0f46                                     .( 
 1413 A:0f46  ad ea 0f                           lda vdir
 1414 A:0f49  30 1a                              bmi vdown
 1415 A:0f4b  ee eb 11                           inc dynvoff
 1416 A:0f4e  d0 03                              bne n1
 1417 A:0f50  ee ec 11                           inc dynvoff+1
 1418 A:0f53  ad eb 11                 n1        lda dynvoff
 1419 A:0f56  18                                 clc 
 1420 A:0f57  69 1e                              adc #30
 1421 A:0f59  c9 3d                              cmp #30+31
 1422 A:0f5b  90 23                              bcc vend
 1423 A:0f5d  ce eb 11                           dec dynvoff
 1424 A:0f60  6e ea 0f                           ror vdir
 1425 A:0f63  d0 1b                              bne vend
 1426 A:0f65  ad eb 11                 vdown     lda dynvoff
 1427 A:0f68  d0 03                              bne n2
 1428 A:0f6a  ce ec 11                           dec dynvoff+1
 1429 A:0f6d  ce eb 11                 n2        dec dynvoff
 1430 A:0f70  ad eb 11                           lda dynvoff
 1431 A:0f73  18                                 clc 
 1432 A:0f74  69 1e                              adc #30
 1433 A:0f76  c9 0f                              cmp #30-15
 1434 A:0f78  b0 06                              bcs vend
 1435 A:0f7a  ee eb 11                           inc dynvoff
 1436 A:0f7d  6e ea 0f                           ror vdir
 1437 A:0f80                           vend      .) 

 1439 A:0f80  a5 09                    checkh    lda cnt2
 1440 A:0f82  29 1f                              and #%00011111
 1441 A:0f84  d0 2e                              bne end

 1443 A:0f86                                     .( 
 1444 A:0f86  ad e9 0f                           lda hdir
 1445 A:0f89  30 15                              bmi hdown
 1446 A:0f8b  ee ed 11                           inc dynhoff
 1447 A:0f8e  ad ed 11                           lda dynhoff
 1448 A:0f91  18                                 clc 
 1449 A:0f92  69 14                              adc #20             ; work aound signed compare
 1450 A:0f94  c9 1c                              cmp #20+8
 1451 A:0f96  90 1c                              bcc hend
 1452 A:0f98  ce ed 11                           dec dynhoff
 1453 A:0f9b  6e e9 0f                           ror hdir
 1454 A:0f9e  d0 14                              bne hend

 1456 A:0fa0  ce ed 11                 hdown     dec dynhoff
 1457 A:0fa3  ad ed 11                           lda dynhoff
 1458 A:0fa6  18                                 clc 
 1459 A:0fa7  69 14                              adc #20
 1460 A:0fa9  c9 0d                              cmp #20-7
 1461 A:0fab  b0 07                              bcs hend
 1462 A:0fad  ee ed 11                           inc dynhoff
 1463 A:0fb0  18                                 clc 
 1464 A:0fb1  6e e9 0f                           ror hdir
 1465 A:0fb4                           hend      .) 

 1467 A:0fb4                           end       
 1468 A:0fb4  a9 22                              lda #VCCY_BRDR_COL
 1469 A:0fb6  8d 80 e8                           sta VDC
 1470 A:0fb9  ee 81 e8                           inc VDC+1
 1471 A:0fbc  60                                 rts 

 1473 A:0fbd  20 20 20 20 20 20 20 ... txt       .asc "           * DYNAMIC SCREEN POSITION"
 1474 A:0fe1  0d 00                              .asc CR,0

 1476 A:0fe3  3f 0f                    itab      .word idemo-1
 1477 A:0fe5  12 02                              .word 530+OFFSET70
 1478 A:0fe7  00 00                              .word 0

 1480 A:0fe9  00                       hdir      .byt 0
 1481 A:0fea  00                       vdir      .byt 0
 1482 A:0feb                                     .) 

 1484 A:0feb                                    ; ---------------------------------------------------------
 1485 A:0feb                                    ; irq chain

 1487 A:0feb  00 00                    last      .word 0
 1488 A:0fed  00 00                    start     .word 0
 1489 A:0fef  00 00                    chain     .word 0

 1491 A:0ff1                           doirq     .( 
 1492 A:0ff1  a2 24                              ldx #VCCY_IRQ_STAT
 1493 A:0ff3  a9 7f                              lda #127             ; clear all Viccy interrupts
 1494 A:0ff5  20 43 11                           jsr sreg

 1496 A:0ff8  ad ef 0f                           lda chain
 1497 A:0ffb  85 04                              sta p2
 1498 A:0ffd  ad f0 0f                           lda chain+1
 1499 A:1000  85 05                              sta p2+1
 1500 A:1002  20 50 10                           jsr run

 1502 A:1005  a0 04                              ldy #4
 1503 A:1007  b1 04                              lda (p2),y
 1504 A:1009  aa                                 tax 
 1505 A:100a  c8                                 iny 
 1506 A:100b  b1 04                              lda (p2),y
 1507 A:100d  d0 04                              bne set
 1508 A:100f  e0 00                              cpx #0
 1509 A:1011  f0 0c                              beq end
 1510 A:1013  8d f0 0f                 set       sta chain+1
 1511 A:1016  85 05                              sta p2+1
 1512 A:1018  8e ef 0f                           stx chain
 1513 A:101b  86 04                              stx p2
 1514 A:101d  d0 10                              bne next
 1515 A:101f  ad ed 0f                 end       lda start
 1516 A:1022  8d ef 0f                           sta chain
 1517 A:1025  85 04                              sta p2
 1518 A:1027  ad ee 0f                           lda start+1
 1519 A:102a  8d f0 0f                           sta chain+1
 1520 A:102d  85 05                              sta p2+1

 1522 A:102f                                    ; ldx #VCCY_BRDR_COL
 1523 A:102f                                    ; lda #0
 1524 A:102f                                    ; jsr sreg
 1525 A:102f                           next      

 1527 A:102f  a0 02                              ldy #2
 1528 A:1031  b1 04                              lda (p2),y
 1529 A:1033  18                                 clc 
 1530 A:1034  6d eb 11                           adc dynvoff
 1531 A:1037  08                                 php 
 1532 A:1038  a2 1e                              ldx #VCCY_RLINE_L
 1533 A:103a  20 43 11                           jsr sreg
 1534 A:103d  c8                                 iny 
 1535 A:103e  e8                                 inx 
 1536 A:103f  b1 04                              lda (p2),y
 1537 A:1041  28                                 plp 
 1538 A:1042  6d ec 11                           adc dynvoff+1
 1539 A:1045  20 43 11                           jsr sreg

 1541 A:1048  a2 23                              ldx #VCCY_IRQ_CTRL
 1542 A:104a  a9 01                              lda #1
 1543 A:104c  20 43 11                           jsr sreg                ; re-enable raster irq

 1545 A:104f  60                                 rts 

 1547 A:1050                           run       
 1548 A:1050  a0 01                              ldy #1
 1549 A:1052  b1 04                              lda (p2),y
 1550 A:1054  48                                 pha 
 1551 A:1055  88                                 dey 
 1552 A:1056  b1 04                              lda (p2),y
 1553 A:1058  48                                 pha 
 1554 A:1059  60                                 rts 
 1555 A:105a                                     .) 

 1557 A:105a                           addirq    .( 
 1558 A:105a  78                                 sei 
 1559 A:105b  ae eb 0f                           ldx last
 1560 A:105e  86 02                              stx p1
 1561 A:1060  ae ec 0f                           ldx last+1
 1562 A:1063  86 03                              stx p1+1
 1563 A:1065  8d eb 0f                           sta last
 1564 A:1068  8c ec 0f                           sty last+1
 1565 A:106b  a0 04                              ldy #4
 1566 A:106d  91 02                              sta (p1),y
 1567 A:106f  c8                                 iny 
 1568 A:1070  ad ec 0f                           lda last+1
 1569 A:1073  91 02                              sta (p1),y
 1570 A:1075  58                                 cli 
 1571 A:1076  60                                 rts 
 1572 A:1077                                     .) 

 1574 A:1077                           insirq    .( 
 1575 A:1077  78                                 sei 
 1576 A:1078  85 06                              sta tmp
 1577 A:107a  84 07                              sty tmp+1

 1579 A:107c  ae ed 0f                           ldx start
 1580 A:107f  86 02                              stx p1
 1581 A:1081  ae ee 0f                           ldx start+1
 1582 A:1084  86 03                              stx p1+1

 1584 A:1086  a0 05                              ldy #5
 1585 A:1088  b1 02                              lda (p1),y
 1586 A:108a  91 06                              sta (tmp),y
 1587 A:108c  88                                 dey 
 1588 A:108d  b1 02                              lda (p1),y
 1589 A:108f  91 06                              sta (tmp),y

 1591 A:1091  a5 06                              lda tmp
 1592 A:1093  91 02                              sta (p1),y
 1593 A:1095  c8                                 iny 
 1594 A:1096  a5 07                              lda tmp+1
 1595 A:1098  91 02                              sta (p1),y

 1597 A:109a  58                                 cli 
 1598 A:109b  60                                 rts 
 1599 A:109c                                     .) 

 1601 A:109c                           resetchain .( 
 1602 A:109c  ad ed 0f                           lda start
 1603 A:109f  85 02                              sta p1
 1604 A:10a1  ad ee 0f                           lda start+1
 1605 A:10a4  85 03                              sta p1+1
 1606 A:10a6  a0 04                    next      ldy #4
 1607 A:10a8  b1 02                              lda (p1),y
 1608 A:10aa  48                                 pha 
 1609 A:10ab  c8                                 iny 
 1610 A:10ac  b1 02                              lda (p1),y
 1611 A:10ae  aa                                 tax 
 1612 A:10af  a9 00                              lda #0
 1613 A:10b1  91 02                              sta (p1),y
 1614 A:10b3  88                                 dey 
 1615 A:10b4  91 02                              sta (p1),y
 1616 A:10b6  86 03                              stx p1+1
 1617 A:10b8  68                                 pla 
 1618 A:10b9  85 02                              sta p1
 1619 A:10bb  05 03                              ora p1+1
 1620 A:10bd  d0 e7                              bne next
 1621 A:10bf  60                                 rts 
 1622 A:10c0                                     .) 

 1624 A:10c0                           stopirq   .( 
 1625 A:10c0  a2 23                              ldx #VCCY_IRQ_CTRL
 1626 A:10c2  a9 00                              lda #0
 1627 A:10c4  4c 43 11                           jmp sreg
 1628 A:10c7                                     .) 

 1630 A:10c7                           inichain  .( 
 1631 A:10c7  a9 f4                              lda #<itab
 1632 A:10c9  8d ef 0f                           sta chain
 1633 A:10cc  8d ed 0f                           sta start
 1634 A:10cf  8d eb 0f                           sta last
 1635 A:10d2  a9 10                              lda #>itab
 1636 A:10d4  8d f0 0f                           sta chain+1
 1637 A:10d7  8d ee 0f                           sta start+1
 1638 A:10da  8d ec 0f                           sta last+1

 1640 A:10dd  ad f6 10                           lda itab+2
 1641 A:10e0  a2 1e                              ldx #VCCY_RLINE_L
 1642 A:10e2  20 43 11                           jsr sreg
 1643 A:10e5  ad f7 10                           lda itab+3
 1644 A:10e8  e8                                 inx 
 1645 A:10e9  20 43 11                           jsr sreg

 1647 A:10ec  a2 23                              ldx #VCCY_IRQ_CTRL
 1648 A:10ee  a9 01                              lda #1             ; enable raster irq
 1649 A:10f0  20 43 11                           jsr sreg
 1650 A:10f3  60                                 rts 

 1652 A:10f4  f9 10                    itab      .word resetscr-1
 1653 A:10f6  1c 02                              .word 540+OFFSET70
 1654 A:10f8  00 00                              .word 0

 1656 A:10fa                           resetscr  
 1657 A:10fa  20 7e 11                           jsr setviccy
 1658 A:10fd  60                                 rts 
 1659 A:10fe                                     .) 

 1661 A:10fe                                    ;setr39 .(
 1662 A:10fe                                    ; sta tmp
 1663 A:10fe                                    ; ldx #VCCY_CTRL
 1664 A:10fe                                    ; stx VDC
 1665 A:10fe                                    ; lda VDC+1
 1666 A:10fe                                    ; and #%11111100
 1667 A:10fe                                    ; ora tmp
 1668 A:10fe                                    ; sta VDC+1
 1669 A:10fe                                    ; rts
 1670 A:10fe                                    ; .)

 1673 A:10fe                                    ; ---------------------------------------------------------

 1675 A:10fe  00 00                    irqsave   .word 0

 1677 A:1100                           newirq    .( 
 1678 A:1100  a9 24                              lda #VCCY_IRQ_STAT
 1679 A:1102  8d 80 e8                           sta VDC
 1680 A:1105  ad 81 e8                           lda VDC+1          ; irq status
 1681 A:1108  10 06                              bpl noloop
 1682 A:110a  20 f1 0f                           jsr doirq
 1683 A:110d  6c fe 10                 retirq    jmp (irqsave)
 1684 A:1110                           noloop    
 1685 A:1110  e6 09                              inc cnt2
 1686 A:1112  d0 02                              bne e
 1687 A:1114  e6 08                              inc cnt
 1688 A:1116  4c 0d 11                 e         jmp retirq
 1689 A:1119                                     .) 

 1691 A:1119                           iniirq    .( 
 1692 A:1119  a5 90                              lda irqvec
 1693 A:111b  8d fe 10                           sta irqsave
 1694 A:111e  a5 91                              lda irqvec+1
 1695 A:1120  8d ff 10                           sta irqsave+1

 1697 A:1123  a9 00                              lda #0
 1698 A:1125  85 08                              sta cnt
 1699 A:1127  85 09                              sta cnt2

 1701 A:1129  08                                 php 
 1702 A:112a  78                                 sei 
 1703 A:112b  a9 00                              lda #<newirq
 1704 A:112d  85 90                              sta irqvec
 1705 A:112f  a9 11                              lda #>newirq
 1706 A:1131  85 91                              sta irqvec+1
 1707 A:1133  28                                 plp 
 1708 A:1134  60                                 rts 
 1709 A:1135                                     .) 

 1711 A:1135                           freirq    .( 
 1712 A:1135  08                                 php 
 1713 A:1136  78                                 sei 
 1714 A:1137  ad fe 10                           lda irqsave
 1715 A:113a  85 90                              sta irqvec
 1716 A:113c  ad ff 10                           lda irqsave+1
 1717 A:113f  85 91                              sta irqvec+1
 1718 A:1141  28                                 plp 
 1719 A:1142  60                                 rts 
 1720 A:1143                                     .) 

 1722 A:1143                                    ; ---------------------------------------------------------

 1724 A:1143                           sreg      .( 
 1725 A:1143  8e 80 e8                           stx VDC
 1726 A:1146  8d 81 e8                           sta VDC+1
 1727 A:1149  60                                 rts 
 1728 A:114a                                     .) 

 1730 A:114a                           clrviccy  .( 
 1731 A:114a  a9 09                              lda #9
 1732 A:114c  8d d7 11                           sta vdctab+VCCY_CHR_HDISP
 1733 A:114f  a9 0f                              lda #15
 1734 A:1151  8d d8 11                           sta vdctab+VCCY_CHR_VDISP

 1736 A:1154  a9 00                              lda #0
 1737 A:1156  a2 33                              ldx #VCCY_SPRT_BASE_0+SPRT_CTRL
 1738 A:1158  20 43 11                           jsr sreg
 1739 A:115b  a2 37                              ldx #VCCY_SPRT_BASE_1+SPRT_CTRL
 1740 A:115d  20 43 11                           jsr sreg
 1741 A:1160  a2 3b                              ldx #VCCY_SPRT_BASE_2+SPRT_CTRL
 1742 A:1162  20 43 11                           jsr sreg
 1743 A:1165  a2 3f                              ldx #VCCY_SPRT_BASE_3+SPRT_CTRL
 1744 A:1167  20 43 11                           jsr sreg
 1745 A:116a  a2 43                              ldx #VCCY_SPRT_BASE_4+SPRT_CTRL
 1746 A:116c  20 43 11                           jsr sreg
 1747 A:116f  a2 47                              ldx #VCCY_SPRT_BASE_5+SPRT_CTRL
 1748 A:1171  20 43 11                           jsr sreg
 1749 A:1174  a2 4b                              ldx #VCCY_SPRT_BASE_6+SPRT_CTRL
 1750 A:1176  20 43 11                           jsr sreg
 1751 A:1179  a2 4f                              ldx #VCCY_SPRT_BASE_7+SPRT_CTRL
 1752 A:117b  20 43 11                           jsr sreg

 1754 A:117e                           setviccy  
 1755 A:117e  a9 03                              lda #SPEED
 1756 A:1180  8d 03 e8                           sta SCTRL                ; 12 MHz CPU
 1757 A:1183  a9 00                              lda #0             ; 40 column, display enable
 1758 A:1185  8d 00 e8                           sta VCTRL
 1759 A:1188  a2 20                              ldx #VCCY_CTRL               ; r39
 1760 A:118a  a9 14                              lda #20
 1761 A:118c  20 43 11                           jsr sreg                ; disable uPET compat mode
 1762 A:118f  a2 08                              ldx #VCCY_MODE               ; r8
 1763 A:1191  a9 80                              lda #128
 1764 A:1193  20 43 11                           jsr sreg                ; 80 col mode via Viccy
 1765 A:1196  a2 28                              ldx #VCCY_ALT1               ; r46
 1766 A:1198  a9 00                              lda #0             ; disable any alt modes
 1767 A:119a  20 43 11                           jsr sreg

 1769 A:119d  a0 00                              ldy #0
 1770 A:119f  8c 80 e8                           sty VDC                ; register number
 1771 A:11a2  b9 c1 11                 l0        lda vdctab,y
 1772 A:11a5  c0 27                              cpy #VCCY_VPOS
 1773 A:11a7  d0 07                              bne hoff
 1774 A:11a9  18                                 clc 
 1775 A:11aa  6d eb 11                           adc dynvoff
 1776 A:11ad  4c b8 11                           jmp nooff
 1777 A:11b0  c0 26                    hoff      cpy #VCCY_HPOS
 1778 A:11b2  d0 04                              bne nooff
 1779 A:11b4  18                                 clc 
 1780 A:11b5  6d ed 11                           adc dynhoff
 1781 A:11b8  8d 83 e8                 nooff     sta VDC+3       ; register value w/ auto-inc of register number
 1782 A:11bb  c8                       lx        iny 
 1783 A:11bc  c0 2a                              cpy #42
 1784 A:11be  90 e2                              bcc l0
 1785 A:11c0  60                                 rts 

 1787 A:11c1  00                       vdctab    .byt 0           ; r0 ignored
 1788 A:11c2  50                                 .byt 80              ; r1 number of chars per line displayed
 1789 A:11c3  00 00 00 00                        .byt 0,0,0,0; r2-5 ignored
 1790 A:11c7  19                                 .byt 25              ; r6 char rows displayed
 1791 A:11c8  00                                 .byt 0              ; r7 ignored
 1792 A:11c9  80                                 .byt 128              ; r8: b7= 80 col mode; b1=interlace, b0=double
 1793 A:11ca  08                                 .byt 8              ; r9: rows per char (-1)
 1794 A:11cb  20                                 .byt 32              ; r10: cursor start (b0-4, b6/5= mode, 00=solid, 01=off, 1x= blink)
 1795 A:11cc  07                                 .byt 7              ; r11: cursor end line
 1796 A:11cd  90                                 .byt >$9000             ; r12: start of vid memory high
 1797 A:11ce  00                                 .byt <$9000             ; r13: start of vid memory low
 1798 A:11cf  92                                 .byt >$9000+9*80+11; r14: cursor pos high
 1799 A:11d0  db                                 .byt <$9000+9*80+11; r15: cursor pos low
 1800 A:11d1  00 00 00 00                        .byt 0,0,0,0; r16-r19: ignored
 1801 A:11d5  d0                                 .byt >$d000             ; r20: start of attribute memory high
 1802 A:11d6  00                                 .byt <$d000             ; r21: start of attribute memory low
 1803 A:11d7  09                                 .byt 9              ; r22: ignored
 1804 A:11d8  0f                                 .byt 15              ; r23: character rows displayed
 1805 A:11d9  00                                 .byt 0              ; r24: b0-3 scroll down, b4: up/low border ext, b5 blink rate, b6: reverse
 1806 A:11da  10                                 .byt 16              ; r25: b0-3 scroll right, b4: l/r border ext, b6: attrib enable, b7: bitmap mode
 1807 A:11db  10                                 .byt BGCOL+16          ; r26: b0-3: bg colour, b4-7: fg colour
 1808 A:11dc  00                                 .byt 0              ; r27: address incr
 1809 A:11dd  00                                 .byt >$00             ; r28: char set address high
 1810 A:11de  07                                 .byt 7              ; r29: underline scanline
 1811 A:11df  00 00                              .byt 0,0        ; r30/31: rasterline counter low/high
 1812 A:11e1  14                                 .byt 4+16        ; r32 (was r39): b2: extended (cpet compat), b4: disp en, b7: upet compat
 1813 A:11e2  0f                                 .byt $0f              ; r33 (was r40): b0-3: bg colour 1, b4-7: bg colour 2
 1814 A:11e3  00                                 .byt BRDCOL                ; r34 (was r41): border colour (b0-3)
 1815 A:11e4  00                                 .byt 0              ; r35 (was r42): irq control
 1816 A:11e5  7f                                 .byt 127              ; r36 (was r43): irq status (clear all sources)
 1817 A:11e6  00                                 .byt 0              ; r37: v/h sync status (VDC)
 1818 A:11e7  09                                 .byt 9              ; r38 (was r44): horizontal position (chars)
 1819 A:11e8  4f                                 .byt 79+OFFSET70          ; r39 (was r45): vertical position (rasterlines)
 1820 A:11e9  00                                 .byt 0              ; r40 (was r46): alt match
 1821 A:11ea  00                                 .byt 0              ; r41 (was r47): alt raster row

 1823 A:11eb                                     .) 

 1825 A:11eb                                    ;dynvoff .word -15
 1826 A:11eb                                    ;dynvoff .word 30
 1827 A:11eb  00 00                    dynvoff   .word 0
 1828 A:11ed                                    ;dynhoff .byt <-7
 1829 A:11ed                                    ;dynhoff .byt 7
 1830 A:11ed  00                       dynhoff   .byt 0

 1832 A:11ee                           clrscr    .( 
 1833 A:11ee  a9 00                              lda #<$8000
 1834 A:11f0  85 02                              sta p1
 1835 A:11f2  a9 80                              lda #>$8000
 1836 A:11f4  85 03                              sta p1+1
 1837 A:11f6  a2 08                              ldx #8             ; number of pages
 1838 A:11f8  a9 20                              lda #32             ; screen space
 1839 A:11fa  a0 00                              ldy #0
 1840 A:11fc  91 02                    l0        sta (p1),y
 1841 A:11fe  c8                                 iny 
 1842 A:11ff  d0 fb                              bne l0
 1843 A:1201  e6 03                              inc p1+1
 1844 A:1203  ca                                 dex 
 1845 A:1204  d0 f6                              bne l0
 1846 A:1206  a2 08                              ldx #8
 1847 A:1208  a9 05                              lda #FGCOL               ; light green
 1848 A:120a  91 02                    l1        sta (p1),y
 1849 A:120c  c8                                 iny 
 1850 A:120d  d0 fb                              bne l1
 1851 A:120f  e6 03                              inc p1+1
 1852 A:1211  ca                                 dex 
 1853 A:1212  d0 f6                              bne l1
 1854 A:1214  60                                 rts 
 1855 A:1215                                     .) 

 1857 A:1215                           hexout    .( 
 1858 A:1215  48                                 pha 
 1859 A:1216  4a                                 lsr 
 1860 A:1217  4a                                 lsr 
 1861 A:1218  4a                                 lsr 
 1862 A:1219  4a                                 lsr 
 1863 A:121a  20 20 12                           jsr digout
 1864 A:121d  68                                 pla 
 1865 A:121e  29 0f                              and #$0f
 1866 A:1220  c9 0a                    digout    cmp #10          ; http:
 1867 A:1222  90 02                              bcc d1
 1868 A:1224  69 66                              adc #$66
 1869 A:1226  49 30                    d1        eor #$30
 1870 A:1228  4c d2 ff                           jmp BSOUT
 1871 A:122b                                     .) 

 1873 A:122b  a9 0d                    crout     lda #13
 1874 A:122d  2c                                 .byt $2c
 1875 A:122e  a9 20                    spout     lda #$20
 1876 A:1230  4c d2 ff                           jmp BSOUT

 1878 A:1233                           txtout    .( 
 1879 A:1233  85 02                              sta p1
 1880 A:1235  84 03                              sty p1+1
 1881 A:1237  a0 00                              ldy #0
 1882 A:1239  b1 02                    l0        lda (p1),y
 1883 A:123b  f0 06                              beq end
 1884 A:123d  20 d2 ff                           jsr BSOUT
 1885 A:1240  c8                                 iny 
 1886 A:1241  d0 f6                              bne l0
 1887 A:1243  60                       end       rts 
 1888 A:1244                                     .) 

 1890 A:1244                           wait      .( 
 1891 A:1244  a2 00                              ldx #0
 1892 A:1246  a0 00                              ldy #0
 1893 A:1248  ea                       l0        nop 
 1894 A:1249  a9 32                              lda #50
 1895 A:124b  38                       l1        sec 
 1896 A:124c  e9 01                              sbc #1
 1897 A:124e  d0 fb                              bne l1
 1898 A:1250  ea                                 nop 
 1899 A:1251  ea                                 nop 
 1900 A:1252  ea                                 nop 
 1901 A:1253  ea                                 nop 
 1902 A:1254  88                                 dey 
 1903 A:1255  d0 f1                              bne l0
 1904 A:1257  ca                                 dex 
 1905 A:1258  d0 ee                              bne l0
 1906 A:125a  60                                 rts 
 1907 A:125b                                     .) 
