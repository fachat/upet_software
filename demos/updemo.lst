
updemo.a65


viccy.i65


    5 A:1000                                    VCCY_HDISP=1
    6 A:1000                                    VCCY_HDISP_MM=5
    7 A:1000                                    VCCY_VDISP=6
    8 A:1000                                    VCCY_MODE=8
    9 A:1000                                    VCCY_CHEIGHT=9
   10 A:1000                                    VCCY_CRSR_STRT=10
   11 A:1000                                    VCCY_CRSR_END=11
   12 A:1000                                    VCCY_MEM_STRT_H=12
   13 A:1000                                    VCCY_MEM_STRT_L=13
   14 A:1000                                    VCCY_CRSR_POS_H=14
   15 A:1000                                    VCCY_CRSR_POS_L=15
   16 A:1000                                    VCCY_ATT_STRT_H=20
   17 A:1000                                    VCCY_ATT_STRT_L=21
   18 A:1000                                    VCCY_CHR_HDISP=22
   19 A:1000                                    VCCY_CHR_VDISP=23
   20 A:1000                                    VCCY_VSCRL=24
   21 A:1000                                    VCCY_HSCRL=25
   22 A:1000                                    VCCY_FGBG_COLS=26
   23 A:1000                                    VCCY_ROW_INC=27
   24 A:1000                                    VCCY_CSET_STRT_H=28
   25 A:1000                                    VCCY_ULINE=29
   26 A:1000                                    VCCY_RLINE_L=30
   27 A:1000                                    VCCY_RLINE_H=31
   28 A:1000                                    VCCY_CTRL=32
   29 A:1000                                    VCCY_EXT_BGCOLS=33
   30 A:1000                                    VCCY_BRDR_COL=34
   31 A:1000                                    VCCY_IRQ_CTRL=35
   32 A:1000                                    VCCY_IRQ_STAT=36
   33 A:1000                                    VCCY_SYNC=37
   34 A:1000                                    VCCY_HPOS=38
   35 A:1000                                    VCCY_VPOS=39
   36 A:1000                                    VCCY_ALT1=40
   37 A:1000                                    VCCY_ALT2=41

   39 A:1000                                    VCCY_CTRL_ATTR=%00000001
   40 A:1000                                    VCCY_CTRL_BITMAP=%00000010
   41 A:1000                                    VCCY_CTRL_EXT=%00000100
   42 A:1000                                    VCCY_CTRL_DISPEN=%00010000
   43 A:1000                                    VCCY_CTRL_PALSEL=%00100000
   44 A:1000                                    VCCY_CTRL_REGMAP=%01000000
   45 A:1000                                    VCCY_CTRL_COMPAT=%10000000

   47 A:1000                                    VCCY_SPRT_BASE=42
   48 A:1000                                    VCCY_SPRT_BRDR=43
   49 A:1000                                    VCCY_SPRT_SPRT=44
   50 A:1000                                    VCCY_SPRT_RSTR=45
   51 A:1000                                    VCCY_SPRT_MCOL1=46
   52 A:1000                                    VCCY_SPRT_MCOL2=47

   54 A:1000                                    VCCY_SPRT_BASE_0=48
   55 A:1000                                    VCCY_SPRT_BASE_1=52
   56 A:1000                                    VCCY_SPRT_BASE_2=56
   57 A:1000                                    VCCY_SPRT_BASE_3=60
   58 A:1000                                    VCCY_SPRT_BASE_4=64
   59 A:1000                                    VCCY_SPRT_BASE_5=68
   60 A:1000                                    VCCY_SPRT_BASE_6=72
   61 A:1000                                    VCCY_SPRT_BASE_7=76

   63 A:1000                                    VCCY_SPRT_COL_0=80
   64 A:1000                                    VCCY_SPRT_COL_1=81
   65 A:1000                                    VCCY_SPRT_COL_2=82
   66 A:1000                                    VCCY_SPRT_COL_3=83
   67 A:1000                                    VCCY_SPRT_COL_4=84
   68 A:1000                                    VCCY_SPRT_COL_5=85
   69 A:1000                                    VCCY_SPRT_COL_6=86
   70 A:1000                                    VCCY_SPRT_COL_7=87

   72 A:1000                                    SPRT_XPOS=0
   73 A:1000                                    SPRT_YPOS=1
   74 A:1000                                    SPRT_XYPOS=2
   75 A:1000                                    SPRT_CTRL=3

   77 A:1000                                    SPRT_CTRL_EN=%00000001
   78 A:1000                                    SPRT_CTRL_XEXP=%00000010
   79 A:1000                                    SPRT_CTRL_YEXP=%00000100
   80 A:1000                                    SPRT_CTRL_MCOL=%00001000
   81 A:1000                                    SPRT_CTRL_BGPRIO=%00010000
   82 A:1000                                    SPRT_CTRL_BRPRIO=%00100000
   83 A:1000                                    SPRT_CTRL_DRES=%01000000
   84 A:1000                                    SPRT_CTRL_ALTPAL=%10000000

   86 A:1000                                    VCCY_PAL_BASE=88

updemo.a65


    4 A:1000                                    ; if defined, print out some measurements for timers etc instead of just OKing

    7 A:1000                                    CHAR=$080000+3*16

    9 A:1000                                    irqvec=$90

   11 A:1000                                    VDC=$e880
   12 A:1000                                    VCTRL=$e800
   13 A:1000                                    SCTRL=$e803

   15 A:1000                                    SPEED=3

   17 A:1000                                    BRDCOL=0           ; black
   18 A:1000                                    BGCOL=0           ; black
   19 A:1000                                    FGCOL=5           ; light green

   21 A:1000                                    HOME=19
   22 A:1000                                    CRSD=17
   23 A:1000                                    CR=13

   25 A:1000                                    p1=$02
   26 A:1000                                    p2=$04
   27 A:1000                                    tmp=$06
   28 A:1000                                    cnt=$08
   29 A:1000                                    cnt2=$09
   30 A:1000                                    tmp2=$0a

   32 A:1000                                    BSOUT=$ffd2

   34 A:1000                                    OFFSET70=22

   36 A:1000  01 04                              .word $0401
   37 A:1002                                     *= $0401

   39 A:0401  0b 04                              .word link
   40 A:0403  0a 00                              .word 10              ; line number
   41 A:0405  9e 31 30 34 30                     .byt $9e,"1040"
   42 A:040a  00                                 .byt 0
   43 A:040b  00 00                    link      .byt $00,$00

   45 A:040d  aa ff 10                           .dsb $0410-*,$aa

   47 A:0410                           l1000                      ; start of program

   49 A:0410  78                                 sei 
   50 A:0411  20 56 10                           jsr iniirq
   51 A:0414                           loop      
   52 A:0414  20 87 10                           jsr clrviccy
   53 A:0417  20 16 11                           jsr clrscr
   54 A:041a  20 04 10                           jsr inichain
   55 A:041d  58                                 cli 

   57 A:041e                                    ;lda #0
   58 A:041e                                    ;sta vdctab+VCCY_VSCRL

   60 A:041e  20 6a 04                           jsr demo1                ; print header
   61 A:0421  20 42 07                           jsr demoborders                ; rasterline ints & borders
   62 A:0424  20 ba 04                           jsr demovdc
   63 A:0427  20 28 05                           jsr democpet
   64 A:042a  20 8a 05                           jsr demomcol
   65 A:042d  20 dc 05                           jsr demoilace
   66 A:0430  20 27 06                           jsr democursor
   67 A:0433  20 73 06                           jsr demohwpos
   68 A:0436  20 d8 06                           jsr demohscrl
   69 A:0439  20 9e 07                           jsr demovert
   70 A:043c  20 79 08                           jsr demo4080
   71 A:043f  20 d1 08                           jsr demo50rows
   72 A:0442  20 53 09                           jsr democset
   73 A:0445  20 b1 0a                           jsr demoreset
   74 A:0448  20 58 0a                           jsr demohires
   75 A:044b  20 c4 0c                           jsr demosprites
   76 A:044e  20 42 0e                           jsr demopalette

   78 A:0451  20 6c 11                           jsr wait
   79 A:0454  20 6c 11                           jsr wait
   80 A:0457  20 6c 11                           jsr wait
   81 A:045a  4c 5a 04                 x         jmp x
   82 A:045d  20 fd 0f                           jsr stopirq
   83 A:0460  78                                 sei 
   84 A:0461  20 d9 0f                           jsr resetchain
   85 A:0464  20 bb 10                           jsr setviccy
   86 A:0467  4c 14 04                           jmp loop

   89 A:046a                                    ; ---------------------------------------------------------

   91 A:046a                                     .( 
   92 A:046a  a9 74                    demo1     lda #<txt
   93 A:046c  a0 04                              ldy #>txt
   94 A:046e  20 5b 11                           jsr txtout
   95 A:0471  4c 6c 11                           jmp wait

   97 A:0474  13 11 11                 txt       .asc HOME,CRSD,CRSD
   98 A:0477  20 20 20 20 20 20 20 ...           .asc "           THE ULTRACPU BOARD ... ON THE WAY TO THE ULTIMATE PET!"
   99 A:04b8  0d 00                              .asc CR,0
  100 A:04ba                                     .) 

  102 A:04ba                                    ; --------------------

  104 A:04ba                                     .( 
  105 A:04ba                           demovdc   
  106 A:04ba  a9 ec                              lda #<txt
  107 A:04bc  a0 04                              ldy #>txt
  108 A:04be  20 5b 11                           jsr txtout

  110 A:04c1  a0 00                              ldy #0
  111 A:04c3  98                       l0        tya 
  112 A:04c4  99 9a 89                           sta $8800+5*80+10,y
  113 A:04c7  c8                                 iny 
  114 A:04c8  c0 3c                              cpy #60
  115 A:04ca  90 f7                              bcc l0

  117 A:04cc  a9 e6                              lda #<itab
  118 A:04ce  a0 04                              ldy #>itab
  119 A:04d0  20 97 0f                           jsr addirq

  121 A:04d3  4c 6c 11                           jmp wait

  123 A:04d6                           idemo2    
  124 A:04d6  a2 20                              ldx #VCCY_CTRL
  125 A:04d8  a9 11                              lda #16+1
  126 A:04da  20 80 10                           jsr sreg                ; disable ColourPet mode, enable attribute mode
  127 A:04dd                                    ; ldx #VCCY_HSCRL
  128 A:04dd                                    ; lda #64+16
  129 A:04dd                                    ; jsr sreg ; enable VDC attribute mode

  131 A:04dd  a9 22                              lda #VCCY_BRDR_COL
  132 A:04df  8d 80 e8                           sta VDC
  133 A:04e2  ee 81 e8                           inc VDC+1
  134 A:04e5  60                                 rts 

  136 A:04e6  d5 04                    itab      .word idemo2-1
  137 A:04e8  ab 00                              .word 149+OFFSET70
  138 A:04ea  00 00                              .word 0

  141 A:04ec  20 20 20 20 20 20 20 ... txt       .asc "           * C128 VDC COMPATIBLE MODE WITH BLINK/UNDERLINE"
  142 A:0526  0d 00                              .asc CR,0
  143 A:0528                                     .) 

  145 A:0528                                    ; --------------------

  147 A:0528                                     .( 
  148 A:0528                           democpet  
  149 A:0528  a9 5a                              lda #<txt
  150 A:052a  a0 05                              ldy #>txt
  151 A:052c  20 5b 11                           jsr txtout

  153 A:052f  a0 00                              ldy #0
  154 A:0531  98                       l0        tya 
  155 A:0532  99 ea 89                           sta $8800+6*80+10,y
  156 A:0535  c8                                 iny 
  157 A:0536  c0 3c                              cpy #60
  158 A:0538  90 f7                              bcc l0

  160 A:053a  a9 54                              lda #<itab
  161 A:053c  a0 05                              ldy #>itab
  162 A:053e  20 97 0f                           jsr addirq

  164 A:0541  4c 6c 11                           jmp wait

  166 A:0544                           idemo3    
  167 A:0544  a2 20                              ldx #VCCY_CTRL
  168 A:0546  a9 14                              lda #20
  169 A:0548  20 80 10                           jsr sreg                ; enable ColourPet mode, disabel attr. mode
  170 A:054b                                    ; ldx #VCCY_HSCRL
  171 A:054b                                    ; lda #0+16
  172 A:054b                                    ; jsr sreg ; disable VDC attribute mode

  174 A:054b  a9 22                              lda #VCCY_BRDR_COL
  175 A:054d  8d 80 e8                           sta VDC
  176 A:0550  ee 81 e8                           inc VDC+1
  177 A:0553  60                                 rts 

  179 A:0554  43 05                    itab      .word idemo3-1
  180 A:0556  bd 00                              .word 167+OFFSET70
  181 A:0558  00 00                              .word 0

  183 A:055a  20 20 20 20 20 20 20 ... txt       .asc "           * COLOUR PET COMPATIBLE COLOUR MODE"
  184 A:0588  0d 00                              .asc CR,0
  185 A:058a                                     .) 

  187 A:058a                                    ; --------------------

  189 A:058a                                     .( 
  190 A:058a                           demomcol  
  191 A:058a  a9 bc                              lda #<txt
  192 A:058c  a0 05                              ldy #>txt
  193 A:058e  20 5b 11                           jsr txtout

  195 A:0591  a0 00                              ldy #0
  196 A:0593  98                       l0        tya 
  197 A:0594  99 3a 8a                           sta $8800+7*80+10,y
  198 A:0597  c8                                 iny 
  199 A:0598  c0 3c                              cpy #60
  200 A:059a  90 f7                              bcc l0

  202 A:059c  a9 b6                              lda #<itab
  203 A:059e  a0 05                              ldy #>itab
  204 A:05a0  20 97 0f                           jsr addirq

  206 A:05a3  4c 6c 11                           jmp wait

  208 A:05a6                           idemo3    
  209 A:05a6  a2 20                              ldx #VCCY_CTRL
  210 A:05a8  a9 15                              lda #20+1
  211 A:05aa  20 80 10                           jsr sreg                ; enable multicol mode 
  212 A:05ad                                    ; ldx #VCCY_HSCRL
  213 A:05ad                                    ; lda #64+16
  214 A:05ad                                    ; jsr sreg ; enable VDC attribute mode (+cpet =multicolour)

  216 A:05ad  a9 22                              lda #VCCY_BRDR_COL
  217 A:05af  8d 80 e8                           sta VDC
  218 A:05b2  ee 81 e8                           inc VDC+1
  219 A:05b5  60                                 rts 

  221 A:05b6  a5 05                    itab      .word idemo3-1
  222 A:05b8  cf 00                              .word 185+OFFSET70
  223 A:05ba  00 00                              .word 0

  225 A:05bc  20 20 20 20 20 20 20 ... txt       .asc "           * MULTI-COLOUR MODE"
  226 A:05da  0d 00                              .asc CR,0
  227 A:05dc                                     .) 

  229 A:05dc                                    ; --------------------

  231 A:05dc                                     .( 
  232 A:05dc                           demoilace 
  233 A:05dc  a9 0a                              lda #<txt
  234 A:05de  a0 06                              ldy #>txt
  235 A:05e0  20 5b 11                           jsr txtout

  237 A:05e3  a9 04                              lda #<itab
  238 A:05e5  a0 06                              ldy #>itab
  239 A:05e7  20 97 0f                           jsr addirq

  241 A:05ea  4c 6c 11                           jmp wait

  243 A:05ed                           idemo4    
  244 A:05ed  a2 20                              ldx #VCCY_CTRL
  245 A:05ef  a9 14                              lda #20
  246 A:05f1  20 80 10                           jsr sreg                ; enable attrib mode 
  247 A:05f4                                    ; ldx #VCCY_HSCRL
  248 A:05f4                                    ; lda #16
  249 A:05f4                                    ; jsr sreg

  251 A:05f4  a2 08                              ldx #VCCY_MODE
  252 A:05f6  a9 82                              lda #2+128
  253 A:05f8  20 80 10                           jsr sreg                ; interlace mode

  255 A:05fb  a9 22                              lda #VCCY_BRDR_COL
  256 A:05fd  8d 80 e8                           sta VDC
  257 A:0600  ee 81 e8                           inc VDC+1
  258 A:0603  60                                 rts 

  260 A:0604  ec 05                    itab      .word idemo4-1
  261 A:0606  e1 00                              .word 203+OFFSET70
  262 A:0608  00 00                              .word 0

  264 A:060a  20 20 20 20 20 20 20 ... txt       .asc "           * INTERLACE MODE"
  265 A:0625  0d 00                              .asc CR,0
  266 A:0627                                     .) 

  268 A:0627                                    ; --------------------

  270 A:0627                                     .( 
  271 A:0627                           democursor 
  272 A:0627  a9 55                              lda #<txt
  273 A:0629  a0 06                              ldy #>txt
  274 A:062b  20 5b 11                           jsr txtout

  276 A:062e  a9 4f                              lda #<itab
  277 A:0630  a0 06                              ldy #>itab
  278 A:0632  20 97 0f                           jsr addirq

  280 A:0635  4c 6c 11                           jmp wait

  282 A:0638                           idemo5    
  283 A:0638  a2 0a                              ldx #10
  284 A:063a  a9 40                              lda #0+64       ; cursor blink on 
  285 A:063c  20 80 10                           jsr sreg

  287 A:063f  a2 08                              ldx #VCCY_MODE
  288 A:0641  a9 80                              lda #128
  289 A:0643  20 80 10                           jsr sreg                ; interlace mode off

  291 A:0646  a9 22                              lda #VCCY_BRDR_COL
  292 A:0648  8d 80 e8                           sta VDC
  293 A:064b  ee 81 e8                           inc VDC+1
  294 A:064e  60                                 rts 

  296 A:064f  37 06                    itab      .word idemo5-1
  297 A:0651  f0 00                              .word 218+OFFSET70
  298 A:0653  00 00                              .word 0

  300 A:0655  20 20 20 20 20 20 20 ... txt       .asc "           * HARDWARE CURSOR"
  301 A:0671  0d 00                              .asc CR,0
  302 A:0673                                     .) 

  304 A:0673                                    ; --------------------

  307 A:0673                                     .( 
  308 A:0673                           demohwpos 
  309 A:0673  a9 ac                              lda #<txt
  310 A:0675  a0 06                              ldy #>txt
  311 A:0677  20 5b 11                           jsr txtout

  313 A:067a  a9 a6                              lda #<itab
  314 A:067c  a0 06                              ldy #>itab
  315 A:067e  20 97 0f                           jsr addirq

  317 A:0681  4c 6c 11                           jmp wait

  319 A:0684                           idemo5    
  320 A:0684  a2 26                              ldx #VCCY_HPOS
  321 A:0686  ad 11 11                           lda vdctab+VCCY_HPOS
  322 A:0689  18                                 clc 
  323 A:068a  69 03                              adc #3             ; shift three to the right
  324 A:068c  20 80 10                           jsr sreg
  325 A:068f  a2 01                              ldx #VCCY_HDISP
  326 A:0691  a9 3c                              lda #60             ; only 60 chars
  327 A:0693  20 80 10                           jsr sreg
  328 A:0696  a2 1b                              ldx #VCCY_ROW_INC
  329 A:0698  a9 14                              lda #20             ; compensate
  330 A:069a  20 80 10                           jsr sreg

  332 A:069d  a9 22                              lda #VCCY_BRDR_COL
  333 A:069f  8d 80 e8                           sta VDC
  334 A:06a2  ee 81 e8                           inc VDC+1
  335 A:06a5  60                                 rts 

  337 A:06a6  83 06                    itab      .word idemo5-1
  338 A:06a8  01 01                              .word 235+OFFSET70
  339 A:06aa  00 00                              .word 0

  341 A:06ac  20 20 20 20 20 20 20 ... txt       .asc "           * HORIZONTAL WIDTH AND POSITION"
  342 A:06d6  0d 00                              .asc CR,0
  343 A:06d8                                     .) 

  345 A:06d8                                    ; --------------------

  347 A:06d8                                     .( 
  348 A:06d8                           demohscrl 
  349 A:06d8  a9 1b                              lda #<txt
  350 A:06da  a0 07                              ldy #>txt
  351 A:06dc  20 5b 11                           jsr txtout

  353 A:06df  a9 15                              lda #<itab
  354 A:06e1  a0 07                              ldy #>itab
  355 A:06e3  20 97 0f                           jsr addirq

  357 A:06e6  4c 6c 11                           jmp wait

  359 A:06e9                           idemo5    
  360 A:06e9  a2 26                              ldx #VCCY_HPOS
  361 A:06eb  ad 11 11                           lda vdctab+VCCY_HPOS            ; reset shift
  362 A:06ee  20 80 10                           jsr sreg
  363 A:06f1  a2 01                              ldx #VCCY_HDISP
  364 A:06f3  a9 50                              lda #80             ; reset chars to 80
  365 A:06f5  20 80 10                           jsr sreg
  366 A:06f8  a2 1b                              ldx #VCCY_ROW_INC
  367 A:06fa  a9 00                              lda #0             ; reset compensate
  368 A:06fc  20 80 10                           jsr sreg

  370 A:06ff  a2 19                              ldx #VCCY_HSCRL
  371 A:0701  a5 09                              lda cnt2
  372 A:0703  4a                                 lsr 
  373 A:0704  4a                                 lsr 
  374 A:0705  4a                                 lsr 
  375 A:0706  4a                                 lsr 
  376 A:0707  09 10                              ora #16
  377 A:0709  20 80 10                           jsr sreg

  379 A:070c  a9 22                              lda #VCCY_BRDR_COL
  380 A:070e  8d 80 e8                           sta VDC
  381 A:0711  ee 81 e8                           inc VDC+1
  382 A:0714  60                                 rts 

  384 A:0715  e8 06                    itab      .word idemo5-1
  385 A:0717  13 01                              .word 253+OFFSET70
  386 A:0719  00 00                              .word 0

  388 A:071b  20 20 20 20 20 20 20 ... txt       .asc "           * HORIZONTAL SMOOTH SCROLL"
  389 A:0740  0d 00                              .asc CR,0
  390 A:0742                                     .) 

  392 A:0742                                    ; --------------------

  394 A:0742                                     .( 
  395 A:0742                           demoborders 
  396 A:0742  a9 6c                              lda #<txt
  397 A:0744  a0 07                              ldy #>txt
  398 A:0746  20 5b 11                           jsr txtout

  400 A:0749  a9 66                              lda #<itab
  401 A:074b  a0 07                              ldy #>itab
  402 A:074d  20 97 0f                           jsr addirq

  404 A:0750  a2 22                              ldx #VCCY_BRDR_COL
  405 A:0752  a9 05                              lda #5
  406 A:0754  20 80 10                           jsr sreg

  408 A:0757  ee 0d 11                           inc vdctab+VCCY_BRDR_COL

  410 A:075a  4c 6c 11                           jmp wait

  412 A:075d                           idemo5    
  413 A:075d  a9 22                              lda #VCCY_BRDR_COL
  414 A:075f  8d 80 e8                           sta VDC
  415 A:0762  ee 81 e8                           inc VDC+1
  416 A:0765  60                                 rts 

  418 A:0766  5c 07                    itab      .word idemo5-1
  419 A:0768  a2 00                              .word 140+OFFSET70
  420 A:076a  00 00                              .word 0

  422 A:076c  0d                       txt       .asc CR
  423 A:076d  20 20 20 20 20 20 20 ...           .asc "           * BORDERS AND RASTERLINE INTERRUPTS"
  424 A:079b  0d 00                              .asc CR,0
  425 A:079d                                     .) 

  427 A:079d                                    ; --------------------

  429 A:079d                                     .( 
  430 A:079d  00                       cur       .byt 0

  432 A:079e                           demovert  
  433 A:079e  a9 f1                              lda #<txt
  434 A:07a0  a0 07                              ldy #>txt
  435 A:07a2  20 5b 11                           jsr txtout

  437 A:07a5  a9 5d                              lda #<itab3
  438 A:07a7  a0 08                              ldy #>itab3
  439 A:07a9  20 b4 0f                           jsr insirq

  441 A:07ac  a9 40                              lda #<itab2
  442 A:07ae  a0 08                              ldy #>itab2
  443 A:07b0  20 b4 0f                           jsr insirq

  445 A:07b3  a9 eb                              lda #<itab
  446 A:07b5  a0 07                              ldy #>itab
  447 A:07b7  20 b4 0f                           jsr insirq

  449 A:07ba  a9 73                              lda #<itabres
  450 A:07bc  a0 08                              ldy #>itabres
  451 A:07be  20 97 0f                           jsr addirq

  453 A:07c1  4c 6c 11                           jmp wait

  455 A:07c4                           idemo5    
  456 A:07c4  a2 19                              ldx #VCCY_HSCRL
  457 A:07c6  a9 10                              lda #16
  458 A:07c8  20 80 10                           jsr sreg

  460 A:07cb  a5 09                              lda cnt2
  461 A:07cd  29 e0                              and #%11100000
  462 A:07cf  4a                                 lsr 
  463 A:07d0  4a                                 lsr 
  464 A:07d1  4a                                 lsr 
  465 A:07d2  4a                                 lsr 
  466 A:07d3  4a                                 lsr 
  467 A:07d4  c9 07                              cmp #7
  468 A:07d6  90 02                              bcc x1
  469 A:07d8  a9 00                              lda #0
  470 A:07da  8d 9d 07                 x1        sta cur

  472 A:07dd  a2 18                              ldx #VCCY_VSCRL
  473 A:07df  20 80 10                           jsr sreg
  474 A:07e2                                    ;sta $8002
  475 A:07e2                           noinc     
  476 A:07e2  a9 22                              lda #VCCY_BRDR_COL
  477 A:07e4  8d 80 e8                           sta VDC
  478 A:07e7  ee 81 e8                           inc VDC+1
  479 A:07ea  60                                 rts 

  481 A:07eb  c3 07                    itab      .word idemo5-1
  482 A:07ed  18 00                              .word 2+OFFSET70
  483 A:07ef  00 00                              .word 0

  485 A:07f1  20 20 20 20 20 20 20 ... txt       .asc "           * VERTICAL SMOOTH SCROLL + VARIABLE CHAR HEIGHT"
  486 A:082b  0d 00                              .asc CR,0

  488 A:082d                           idemo2    
  489 A:082d  ad 9d 07                           lda cur
  490 A:0830  69 07                              adc #7
  491 A:0832  a2 09                              ldx #VCCY_CHEIGHT
  492 A:0834  20 80 10                           jsr sreg

  494 A:0837  a2 22                              ldx #VCCY_BRDR_COL
  495 A:0839  8e 80 e8                           stx VDC
  496 A:083c  ee 81 e8                           inc VDC+1
  497 A:083f  60                                 rts 

  499 A:0840  2c 08                    itab2     .word idemo2-1
  500 A:0842  8b 00                              .word 117+OFFSET70
  501 A:0844  00 00                              .word 0

  503 A:0846                           idemo3    
  504 A:0846  a2 09                              ldx #VCCY_CHEIGHT
  505 A:0848  a9 08                              lda #8
  506 A:084a  20 80 10                           jsr sreg

  508 A:084d  a2 18                              ldx #VCCY_VSCRL
  509 A:084f  a9 00                              lda #0
  510 A:0851  20 80 10                           jsr sreg

  512 A:0854  a2 22                              ldx #VCCY_BRDR_COL
  513 A:0856  8e 80 e8                           stx VDC
  514 A:0859  ee 81 e8                           inc VDC+1
  515 A:085c  60                                 rts 

  518 A:085d  45 08                    itab3     .word idemo3-1
  519 A:085f  9d 00                              .word 135+OFFSET70
  520 A:0861  00 00                              .word 0

  522 A:0863                           idemores  
  523 A:0863  a2 19                              ldx #VCCY_HSCRL
  524 A:0865  a9 10                              lda #16
  525 A:0867  20 80 10                           jsr sreg
  526 A:086a  a2 22                              ldx #VCCY_BRDR_COL
  527 A:086c  8e 80 e8                           stx VDC
  528 A:086f  ee 81 e8                           inc VDC+1
  529 A:0872  60                                 rts 

  531 A:0873  62 08                    itabres   .word idemores-1
  532 A:0875  25 01                              .word 271+OFFSET70
  533 A:0877  00 00                              .word 0

  536 A:0879                                     .) 

  538 A:0879                                    ; --------------------

  540 A:0879                                     .( 
  541 A:0879                           demo4080  
  542 A:0879  a9 ad                              lda #<txt
  543 A:087b  a0 08                              ldy #>txt
  544 A:087d  20 5b 11                           jsr txtout

  546 A:0880  a9 a7                              lda #<itab
  547 A:0882  a0 08                              ldy #>itab
  548 A:0884  20 97 0f                           jsr addirq

  550 A:0887  4c 6c 11                           jmp wait

  552 A:088a  a2 08                    idemo5    ldx #VCCY_MODE
  553 A:088c  a9 00                              lda #0
  554 A:088e  20 80 10                           jsr sreg

  556 A:0891  a2 01                              ldx #VCCY_HDISP
  557 A:0893  a9 28                              lda #40             ; 40 cols per line
  558 A:0895  20 80 10                           jsr sreg
  559 A:0898  a2 1b                              ldx #VCCY_ROW_INC               ; compensate 40 chars 
  560 A:089a  20 80 10                           jsr sreg

  562 A:089d  a9 22                              lda #VCCY_BRDR_COL
  563 A:089f  8d 80 e8                           sta VDC
  564 A:08a2  ee 81 e8                           inc VDC+1
  565 A:08a5  60                                 rts 

  567 A:08a6  60                                 rts 

  569 A:08a7  89 08                    itab      .word idemo5-1
  570 A:08a9  37 01                              .word 289+OFFSET70
  571 A:08ab  00 00                              .word 0

  573 A:08ad  20 20 20 20 20 20 20 ... txt       .asc "           * SWITCHABLE 40/80 COLS"
  574 A:08cf  0d 00                              .asc CR,0
  575 A:08d1                                     .) 

  577 A:08d1                                    ; --------------------

  579 A:08d1                                     .( 
  580 A:08d1                           demo50rows 
  581 A:08d1  a9 e9                              lda #<txt
  582 A:08d3  a0 08                              ldy #>txt
  583 A:08d5  20 5b 11                           jsr txtout

  585 A:08d8  a9 40                              lda #<itab
  586 A:08da  a0 09                              ldy #>itab
  587 A:08dc  20 97 0f                           jsr addirq

  589 A:08df  a9 4d                              lda #<itab2
  590 A:08e1  a0 09                              ldy #>itab2
  591 A:08e3  20 97 0f                           jsr addirq

  593 A:08e6  4c 6c 11                           jmp wait

  595 A:08e9  20 20 20 20 20 20 20 ... txt       .asc "           * 50 ROW MODES - UP TO 96","x"-32,"71 CHARS"
  596 A:0916  0d 00                              .asc CR,0

  598 A:0918                           idemo5    
  599 A:0918  a2 25                              ldx #VCCY_SYNC
  600 A:091a  8e 80 e8                           stx VDC
  601 A:091d  2c 81 e8                 l0        bit VDC+1
  602 A:0920  50 fb                              bvc l0

  604 A:0922  a2 08                              ldx #VCCY_MODE
  605 A:0924  a9 83                              lda #128+3       ; 50x80 mode
  606 A:0926  20 80 10                           jsr sreg

  608 A:0929  a2 01                              ldx #VCCY_HDISP
  609 A:092b  a9 50                              lda #80             ; reset 40 cols per line
  610 A:092d  20 80 10                           jsr sreg
  611 A:0930  a9 00                              lda #0
  612 A:0932  a2 1b                              ldx #VCCY_ROW_INC               ; reset compensate 40 chars 
  613 A:0934  20 80 10                           jsr sreg

  615 A:0937  a9 22                              lda #VCCY_BRDR_COL
  616 A:0939  8d 80 e8                           sta VDC
  617 A:093c  ee 81 e8                           inc VDC+1
  618 A:093f  60                                 rts 

  620 A:0940  17 09                    itab      .word idemo5-1
  621 A:0942  49 01                              .word 325-18+OFFSET70
  622 A:0944  00 00                              .word 0

  624 A:0946  a2 08                    idemox    ldx #VCCY_MODE
  625 A:0948  a9 80                              lda #128
  626 A:094a  4c 80 10                           jmp sreg

  628 A:094d  45 09                    itab2     .word idemox-1
  629 A:094f  52 01                              .word 316+OFFSET70
  630 A:0951  00 00                              .word 0

  632 A:0953                                     .) 

  634 A:0953                                    ; --------------------
  635 A:0953                                     .( 
  636 A:0953                           democset  
  637 A:0953  a9 15                              lda #<txt
  638 A:0955  a0 0a                              ldy #>txt
  639 A:0957  20 5b 11                           jsr txtout

  641 A:095a  a9 8d                              lda #<itab
  642 A:095c  a0 09                              ldy #>itab
  643 A:095e  20 97 0f                           jsr addirq

  645 A:0961  a9 0f                              lda #<itab2
  646 A:0963  a0 0a                              ldy #>itab2
  647 A:0965  20 97 0f                           jsr addirq

  649 A:0968  4c 6c 11                           jmp wait

  651 A:096b                           idemo5    
  652 A:096b  a2 25                              ldx #VCCY_SYNC
  653 A:096d  8e 80 e8                           stx VDC
  654 A:0970  2c 81 e8                 l         bit VDC+1
  655 A:0973  50 fb                              bvc l

  657 A:0975  a2 08                              ldx #VCCY_MODE
  658 A:0977  a9 80                              lda #128             ; 25x80 mode
  659 A:0979  20 80 10                           jsr sreg

  661 A:097c  a2 09                              ldx #VCCY_CHEIGHT
  662 A:097e  a9 0b                              lda #11             ; 12 rasterlines/char
  663 A:0980  20 80 10                           jsr sreg

  665 A:0983  a9 22                              lda #VCCY_BRDR_COL
  666 A:0985  8d 80 e8                           sta VDC
  667 A:0988  ee 81 e8                           inc VDC+1
  668 A:098b  60                                 rts 

  670 A:098c  00                       mode      .byt 0

  672 A:098d  6a 09                    itab      .word idemo5-1
  673 A:098f  5b 01                              .word 325+OFFSET70
  674 A:0991  00 00                              .word 0

  676 A:0993  a2 09                    idemox    ldx #VCCY_CHEIGHT
  677 A:0995  a9 08                              lda #8             ; 9 rasterlines/char
  678 A:0997  20 80 10                           jsr sreg

  680 A:099a  a5 09                              lda cnt2
  681 A:099c  29 0f                              and #15
  682 A:099e  d0 66                              bne end

  684 A:09a0  ac 8c 09                           ldy mode
  685 A:09a3  d0 26                              bne mode1

  687 A:09a5                           mode0     .( 
  688 A:09a5                                    ; scroll a single char
  689 A:09a5  a2 0f                              ldx #VCCY_CRSR_POS_L
  690 A:09a7  bf 30 00 08                        lda CHAR,x
  691 A:09ab  48                                 pha 

  693 A:09ac  ca                       l0        dex 
  694 A:09ad  bf 30 00 08                        lda CHAR,x
  695 A:09b1  4a                                 lsr 
  696 A:09b2  90 02                              bcc l1
  697 A:09b4  09 80                              ora #$80
  698 A:09b6  e8                       l1        inx 
  699 A:09b7  9f 30 00 08                        sta CHAR,x
  700 A:09bb  ca                                 dex 
  701 A:09bc  d0 ee                              bne l0

  703 A:09be  68                                 pla 
  704 A:09bf  4a                                 lsr 
  705 A:09c0  90 02                              bcc l2
  706 A:09c2  09 80                              ora #$80
  707 A:09c4  9f 30 00 08              l2        sta CHAR,x
  708 A:09c8  4c f0 09                           jmp checkmode
  709 A:09cb                                     .) 
  710 A:09cb                           mode1     .( 
  711 A:09cb                                    ; R22/R23 horizontal/vertical displayed pixel per char
  712 A:09cb  a5 09                              lda cnt2
  713 A:09cd  4a                                 lsr 
  714 A:09ce  4a                                 lsr 
  715 A:09cf  4a                                 lsr 
  716 A:09d0  4a                                 lsr 
  717 A:09d1  88                                 dey 
  718 A:09d2  d0 14                              bne m                ; mode2, jump r23
  719 A:09d4  a2 16                              ldx #VCCY_CHR_HDISP
  720 A:09d6  85 06                              sta tmp
  721 A:09d8  a9 0f                              lda #15
  722 A:09da  38                                 sec 
  723 A:09db  e5 06                              sbc tmp
  724 A:09dd  d0 0e                              bne store
  725 A:09df  a9 01                              lda #1
  726 A:09e1  8d 02 11                           sta vdctab+VCCY_CHR_VDISP            ; initialize next mode
  727 A:09e4  a9 08                              lda #8
  728 A:09e6  d0 05                              bne store

  730 A:09e8  a2 17                    m         ldx #VCCY_CHR_VDISP
  731 A:09ea  18                                 clc 
  732 A:09eb  69 01                              adc #1
  733 A:09ed  9d eb 10                 store     sta vdctab,x
  734 A:09f0                                     .) 
  735 A:09f0                           checkmode .( 
  736 A:09f0  a5 09                              lda cnt2
  737 A:09f2  29 f0                              and #$f0
  738 A:09f4  49 f0                              eor #$f0
  739 A:09f6  d0 0e                              bne end
  740 A:09f8  ee 8c 09                           inc mode
  741 A:09fb  ad 8c 09                           lda mode
  742 A:09fe  38                                 sec 
  743 A:09ff  e9 03                              sbc #3
  744 A:0a01  d0 03                              bne end
  745 A:0a03  8d 8c 09                           sta mode
  746 A:0a06                                     .) 

  748 A:0a06                           end       
  749 A:0a06  a9 22                              lda #VCCY_BRDR_COL
  750 A:0a08  8d 80 e8                           sta VDC
  751 A:0a0b  ee 81 e8                           inc VDC+1
  752 A:0a0e  60                                 rts 

  755 A:0a0f  92 09                    itab2     .word idemox-1
  756 A:0a11  77 01                              .word 353+OFFSET70
  757 A:0a13  00 00                              .word 0

  759 A:0a15  20 20 20 20 20 20 20 ... txt       .asc "           * RE-DEFINABLE CHARACTER SET, LARGE HEIGHT AND CUT-OFF"
  760 A:0a56  0d 00                              .asc CR,0
  761 A:0a58                                     .) 

  763 A:0a58                                    ; --------------------

  765 A:0a58                                    ; must be last, as it starts hires
  766 A:0a58                                     .( 
  767 A:0a58                           demohires 
  768 A:0a58  a9 6a                              lda #<txt
  769 A:0a5a  a0 0a                              ldy #>txt
  770 A:0a5c  20 5b 11                           jsr txtout

  772 A:0a5f  a9 01                              lda #1
  773 A:0a61  8d ad 0a                           sta resmode
  774 A:0a64  8d ae 0a                           sta rescnt

  776 A:0a67  4c 6c 11                           jmp wait

  778 A:0a6a  20 20 20 20 20 20 20 ... txt       .asc "           * HIRES (SINGLE COLOUR, ATTRIBUTE, FG/BG, MULTI) MODES"
  779 A:0aab  0d 00                              .asc CR,0
  780 A:0aad                                     .) 
  781 A:0aad                                    ; --------------------

  783 A:0aad                                    ; starts split screen mode

  785 A:0aad  00                       resmode   .byt 0
  786 A:0aae  00                       rescnt    .byt 0

  788 A:0aaf  00                       resfl     .byt 0

  790 A:0ab0                                     .( 
  791 A:0ab0  00                       cur       .byt 0

  793 A:0ab1                           demoreset 
  794 A:0ab1  a9 00                              lda #0
  795 A:0ab3  8d ad 0a                           sta resmode
  796 A:0ab6  8d ae 0a                           sta rescnt

  798 A:0ab9  a9 7f                              lda #<txt
  799 A:0abb  a0 0c                              ldy #>txt
  800 A:0abd  20 5b 11                           jsr txtout

  802 A:0ac0  a9 4a                              lda #<itab
  803 A:0ac2  a0 0c                              ldy #>itab
  804 A:0ac4  20 97 0f                           jsr addirq

  806 A:0ac7  a9 79                              lda #<itabc
  807 A:0ac9  a0 0c                              ldy #>itabc
  808 A:0acb  20 97 0f                           jsr addirq

  810 A:0ace                                    ; set hires buffer
  811 A:0ace  08                                 php 
  812 A:0acf  78                                 sei 

  814 A:0ad0                                    ; go to native / wide mode
  815 A:0ad0  18                                 clc 
  816 A:0ad1  fb                                 xce 
  817 A:0ad2                                    ; set X/Y registers to 16 bit ...
  818 A:0ad2  c2 10                              rep #%00010000
  819 A:0ad4                                     .xl 

  821 A:0ad4  a9 00                              lda #0
  822 A:0ad6  a2 ff 1f                           ldx #$1fff
  823 A:0ad9  9f 00 40 08              l3        sta $084000,x
  824 A:0add                                    ;txa
  825 A:0add  ca                                 dex 
  826 A:0ade  d0 f9                              bne l3

  828 A:0ae0  c2 30                              rep #%00110000
  829 A:0ae2                                     .al 

  831 A:0ae2  a9 00 00                           lda #$00             ; value
  832 A:0ae5  48                       l2        pha 
  833 A:0ae6                                    ; times 80=64+16 to get top down bytes
  834 A:0ae6  0a                                 asl 
  835 A:0ae7  0a                                 asl 
  836 A:0ae8  0a                                 asl 
  837 A:0ae9  0a                                 asl 
  838 A:0aea  85 06                              sta tmp                ; x16
  839 A:0aec  0a                                 asl 
  840 A:0aed  0a                                 asl                    ; x64
  841 A:0aee  18                                 clc 
  842 A:0aef  65 06                              adc tmp                ; x80
  843 A:0af1  aa                                 tax 
  844 A:0af2  68                                 pla 
  845 A:0af3  9f 14 40 08                        sta $084014,x
  846 A:0af7  9f 16 40 08                        sta $084016,x
  847 A:0afb  9f 18 40 08                        sta $084018,x
  848 A:0aff  9f 1a 40 08                        sta $08401a,x
  849 A:0b03  18                                 clc 
  850 A:0b04  69 01 00                           adc #1
  851 A:0b07  c9 80 00                           cmp #$80
  852 A:0b0a  90 d9                              bcc l2

  854 A:0b0c                                    ; draw a line
  855 A:0b0c  a9 00 00                           lda #0
  856 A:0b0f  aa                       :           tax 
  857 A:0b10  a8                                 tay 
  858 A:0b11  48                                 pha 
  859 A:0b12  20 3e 0b                           jsr dot_wxa
  860 A:0b15  68                                 pla 
  861 A:0b16  48                                 pha 
  862 A:0b17  18                                 clc 
  863 A:0b18                                    ;adc #128
  864 A:0b18  aa                                 tax 
  865 A:0b19  68                                 pla 
  866 A:0b1a  48                                 pha 
  867 A:0b1b  38                                 sec 
  868 A:0b1c  e9 80 00                           sbc #128
  869 A:0b1f  49 ff ff                           eor #$ffff
  870 A:0b22  a8                                 tay 
  871 A:0b23  20 3e 0b                           jsr dot_wxa
  872 A:0b26  68                                 pla 
  873 A:0b27  18                                 clc 
  874 A:0b28  69 01 00                           adc #1
  875 A:0b2b  c9 80 00                           cmp #128
  876 A:0b2e  90 df                              bcc :-

  878 A:0b30                                    ; end native / wide mode
  879 A:0b30  a9 00 00                           lda #0
  880 A:0b33  a2 00 00                           ldx #0
  881 A:0b36  e2 30                              sep #%00110000

  883 A:0b38  38                                 sec 
  884 A:0b39  fb                                 xce 

  886 A:0b3a                                     .xs 
  887 A:0b3a                                     .as 
  888 A:0b3a  28                                 plp 

  890 A:0b3b  4c 6c 11                           jmp wait

  892 A:0b3e                                     .al 
  893 A:0b3e                                     .xl 

  895 A:0b3e                           dot_wxa                    ; draw a hires dot on x/y
  896 A:0b3e  98                                 tya 
  897 A:0b3f  0a                                 asl 
  898 A:0b40  0a                                 asl 
  899 A:0b41  0a                                 asl 
  900 A:0b42  0a                                 asl                    ; x16
  901 A:0b43  85 06                              sta tmp
  902 A:0b45  0a                                 asl 
  903 A:0b46  0a                                 asl                    ; x64
  904 A:0b47  18                                 clc 
  905 A:0b48  65 06                              adc tmp
  906 A:0b4a  85 06                              sta tmp
  907 A:0b4c  8a                                 txa 
  908 A:0b4d  4a                                 lsr 
  909 A:0b4e  4a                                 lsr 
  910 A:0b4f  4a                                 lsr 
  911 A:0b50  29 fe 00                           and #$fe             ; index in line
  912 A:0b53  18                                 clc 
  913 A:0b54  65 06                              adc tmp
  914 A:0b56  85 06                              sta tmp
  915 A:0b58  8a                                 txa 
  916 A:0b59  29 0f 00                           and #$0f             ; index in word
  917 A:0b5c  0a                                 asl 
  918 A:0b5d  a8                                 tay 
  919 A:0b5e  b9 6c 0b                           lda dottab,y
  920 A:0b61  a6 06                              ldx tmp
  921 A:0b63  1f 20 40 08                        ora $084020,x
  922 A:0b67  9f 20 40 08                        sta $084020,x
  923 A:0b6b  60                                 rts 

  925 A:0b6c  80 00                    dottab    .word $80
  926 A:0b6e  40 00                              .word $40
  927 A:0b70  20 00                              .word $20
  928 A:0b72  10 00                              .word $10
  929 A:0b74  08 00                              .word $08
  930 A:0b76  04 00                              .word $04
  931 A:0b78  02 00                              .word $02
  932 A:0b7a  01 00                              .word $01
  933 A:0b7c  00 80                              .word $8000
  934 A:0b7e  00 40                              .word $4000
  935 A:0b80  00 20                              .word $2000
  936 A:0b82  00 10                              .word $1000
  937 A:0b84  00 08                              .word $0800
  938 A:0b86  00 04                              .word $0400
  939 A:0b88  00 02                              .word $0200
  940 A:0b8a  00 01                              .word $0100

  942 A:0b8c                                     .as 
  943 A:0b8c                                     .xs 

  945 A:0b8c                           idemo5                     ; if alt registers are set during raster match, they are effective in the next rasterline already!
  946 A:0b8c  a2 28                              ldx #VCCY_ALT1
  947 A:0b8e  a9 01                              lda #1
  948 A:0b90  20 80 10                           jsr sreg

  950 A:0b93  ad ad 0a                           lda resmode
  951 A:0b96  f0 3e                              beq text

  953 A:0b98  ac ae 0a                           ldy rescnt
  954 A:0b9b  f0 39                              beq text

  956 A:0b9d                           hres1     
  957 A:0b9d  a2 0c                              ldx #VCCY_MEM_STRT_H
  958 A:0b9f  a9 40                              lda #>$4000
  959 A:0ba1  20 80 10                           jsr sreg
  960 A:0ba4  e8                                 inx 
  961 A:0ba5  a9 00                              lda #<$4000
  962 A:0ba7  20 80 10                           jsr sreg

  964 A:0baa  a2 14                              ldx #VCCY_ATT_STRT_H
  965 A:0bac  a9 d1                              lda #>$d000+5*80
  966 A:0bae  20 80 10                           jsr sreg
  967 A:0bb1  e8                                 inx 
  968 A:0bb2  a9 90                              lda #<$d000+5*80
  969 A:0bb4  20 80 10                           jsr sreg

  971 A:0bb7  88                                 dey 
  972 A:0bb8  d0 0a                              bne hres2

  974 A:0bba  a9 e2                              lda #128+64+32+2
  975 A:0bbc  a2 28                    set       ldx #VCCY_ALT1
  976 A:0bbe  20 80 10                           jsr sreg                ; disable ColourPet mode

  978 A:0bc1  4c fa 0b                           jmp common

  980 A:0bc4  88                       hres2     dey 
  981 A:0bc5  d0 04                              bne hres3

  983 A:0bc7  a9 e6                              lda #128+64+32+4+2
  984 A:0bc9  d0 f1                              bne set

  986 A:0bcb  88                       hres3     dey 
  987 A:0bcc  d0 04                              bne hres4

  989 A:0bce  a9 ea                              lda #128+64+32+8+2
  990 A:0bd0  d0 ea                              bne set

  992 A:0bd2  a9 ee                    hres4     lda #128+64+32+8+4+2
  993 A:0bd4  d0 e6                              bne set

  995 A:0bd6                           text      
  996 A:0bd6  a2 0c                              ldx #VCCY_MEM_STRT_H
  997 A:0bd8  a9 91                              lda #>$9000+5*80
  998 A:0bda  20 80 10                           jsr sreg
  999 A:0bdd  e8                                 inx 
 1000 A:0bde  a9 90                              lda #<$9000+5*80
 1001 A:0be0  20 80 10                           jsr sreg

 1003 A:0be3  a2 14                              ldx #VCCY_ATT_STRT_H
 1004 A:0be5  a9 d1                              lda #>$d000+5*80
 1005 A:0be7  20 80 10                           jsr sreg
 1006 A:0bea  e8                                 inx 
 1007 A:0beb  a9 90                              lda #<$d000+5*80
 1008 A:0bed  20 80 10                           jsr sreg

 1010 A:0bf0  a2 28                              ldx #VCCY_ALT1
 1011 A:0bf2  a9 e8                              lda #128+64+32+8
 1012 A:0bf4  20 80 10                           jsr sreg                ; disable ColourPet mode

 1014 A:0bf7  4c fa 0b                           jmp common

 1016 A:0bfa                           common    
 1017 A:0bfa  a9 80                              lda #128
 1018 A:0bfc  a2 29                              ldx #VCCY_ALT2
 1019 A:0bfe  20 80 10                           jsr sreg

 1021 A:0c01  ad ad 0a                           lda resmode
 1022 A:0c04  f0 19                              beq noinc
 1023 A:0c06  a5 09                              lda cnt2
 1024 A:0c08  d0 15                              bne noinc
 1025 A:0c0a  a5 08                              lda cnt
 1026 A:0c0c  29 01                              and #1
 1027 A:0c0e  d0 0f                              bne noinc

 1029 A:0c10  ee ae 0a                           inc rescnt
 1030 A:0c13  ad ae 0a                           lda rescnt
 1031 A:0c16  c9 05                              cmp #5
 1032 A:0c18  90 05                              bcc noinc
 1033 A:0c1a  a9 00                              lda #0
 1034 A:0c1c  8d ae 0a                           sta rescnt
 1035 A:0c1f                           noinc     

 1037 A:0c1f  a5 08                              lda cnt
 1038 A:0c21  4a                                 lsr 
 1039 A:0c22  a5 09                              lda cnt2
 1040 A:0c24  6a                                 ror 
 1041 A:0c25  4a                                 lsr 
 1042 A:0c26  c9 52                              cmp #82
 1043 A:0c28  90 02                              bcc l1
 1044 A:0c2a  a9 52                              lda #82
 1045 A:0c2c  8d b0 0a                 l1        sta cur
 1046 A:0c2f  a9 0a                              lda #<500+OFFSET70
 1047 A:0c31  38                                 sec 
 1048 A:0c32  ed b0 0a                           sbc cur
 1049 A:0c35  09 01                              ora #1             ; that prevents the top line from flickering, as we are in non-interlace mode
 1050 A:0c37  8d 4c 0c                           sta line
 1051 A:0c3a  a9 02                              lda #>500+OFFSET70
 1052 A:0c3c  e9 00                              sbc #0
 1053 A:0c3e  8d 4d 0c                           sta line+1

 1055 A:0c41  a9 22                              lda #VCCY_BRDR_COL
 1056 A:0c43  8d 80 e8                           sta VDC
 1057 A:0c46  ee 81 e8                           inc VDC+1

 1059 A:0c49  60                                 rts 

 1061 A:0c4a  8b 0b                    itab      .word idemo5-1
 1062 A:0c4c  aa 01                    line      .word 404+OFFSET70
 1063 A:0c4e  00 00                              .word 0

 1065 A:0c50                           iclr      
 1066 A:0c50  a2 28                              ldx #VCCY_ALT1
 1067 A:0c52  a9 00                              lda #0
 1068 A:0c54  20 80 10                           jsr sreg

 1070 A:0c57  a2 29                              ldx #VCCY_ALT2
 1071 A:0c59  a9 00                              lda #0
 1072 A:0c5b  20 80 10                           jsr sreg

 1074 A:0c5e  ad b0 0a                           lda cur
 1075 A:0c61  18                                 clc 
 1076 A:0c62  69 00                              adc #0
 1077 A:0c64  a8                       l0        tay 
 1078 A:0c65  38                                 sec 
 1079 A:0c66  e9 09                              sbc #9
 1080 A:0c68  b0 fa                              bcs l0
 1081 A:0c6a  98                                 tya 
 1082 A:0c6b  4a                                 lsr 
 1083 A:0c6c  09 10                              ora #16
 1084 A:0c6e  a2 18                              ldx #VCCY_VSCRL
 1085 A:0c70                                    ; jsr sreg

 1087 A:0c70  a9 22                              lda #VCCY_BRDR_COL
 1088 A:0c72  8d 80 e8                           sta VDC
 1089 A:0c75  ee 81 e8                           inc VDC+1
 1090 A:0c78  60                                 rts 

 1092 A:0c79  4f 0c                    itabc     .word iclr-1
 1093 A:0c7b  0f 02                              .word 505+OFFSET70
 1094 A:0c7d  00 00                              .word 0

 1096 A:0c7f  20 20 20 20 20 20 20 ... txt       .asc "           * RESETABLE ADDRESS COUNTERS/PALETTE ON RASTERLINE MATCH"
 1097 A:0cc2  0d 00                              .asc CR,0
 1098 A:0cc4                                     .) 

 1100 A:0cc4                                    ; ---------------------------------------------------------
 1101 A:0cc4                                    ; sprite demo

 1103 A:0cc4                                     .( 
 1104 A:0cc4                           demosprites 
 1105 A:0cc4  a9 b3                              lda #<txt
 1106 A:0cc6  a0 0d                              ldy #>txt
 1107 A:0cc8  20 5b 11                           jsr txtout

 1109 A:0ccb                                     .( 
 1110 A:0ccb  a2 3f                              ldx #63             ; sprite data
 1111 A:0ccd  bd f3 0d                 l         lda s_balloon,x
 1112 A:0cd0  9f c0 8f 08                        sta $089000-64,x
 1113 A:0cd4  ca                                 dex 
 1114 A:0cd5  10 f6                              bpl l
 1115 A:0cd7                                     .) 

 1117 A:0cd7                                    ; alternate palette for the sprite
 1118 A:0cd7                                     .( 
 1119 A:0cd7                                    ; enable access to alternate palette
 1120 A:0cd7  a2 28                              ldx #VCCY_ALT1
 1121 A:0cd9  a9 01                              lda #1
 1122 A:0cdb  20 80 10                           jsr sreg

 1124 A:0cde                                    ; access first half of the palette
 1125 A:0cde  a2 20                              ldx #VCCY_CTRL
 1126 A:0ce0  8e 80 e8                           stx VDC
 1127 A:0ce3  ad 81 e8                           lda VDC+1
 1128 A:0ce6  29 df                              and #%11011111
 1129 A:0ce8  8d 81 e8                           sta VDC+1

 1131 A:0ceb                                    ; first half of palette
 1132 A:0ceb  a9 58                              lda #VCCY_PAL_BASE
 1133 A:0ced  8d 80 e8                           sta VDC
 1134 A:0cf0  a2 00                              ldx #0
 1135 A:0cf2  bd 32 0e                 l         lda sprite_pal,x
 1136 A:0cf5  8d 83 e8                           sta VDC+3
 1137 A:0cf8  e8                                 inx 
 1138 A:0cf9  e0 08                              cpx #8
 1139 A:0cfb  90 f5                              bcc l

 1141 A:0cfd                                    ; access second half of the palette
 1142 A:0cfd  a9 20                              lda #VCCY_CTRL
 1143 A:0cff  8d 80 e8                           sta VDC
 1144 A:0d02  ad 81 e8                           lda VDC+1
 1145 A:0d05  09 20                              ora #%00100000
 1146 A:0d07  8d 81 e8                           sta VDC+1

 1148 A:0d0a                                    ; second half of palette
 1149 A:0d0a  a9 58                              lda #VCCY_PAL_BASE
 1150 A:0d0c  8d 80 e8                           sta VDC
 1151 A:0d0f  bd 32 0e                 l2        lda sprite_pal,x
 1152 A:0d12  8d 83 e8                           sta VDC+3
 1153 A:0d15  e8                                 inx 
 1154 A:0d16  e0 10                              cpx #16
 1155 A:0d18  90 f5                              bcc l2

 1157 A:0d1a                                    ; access first half of the palette again
 1158 A:0d1a  a9 20                              lda #VCCY_CTRL
 1159 A:0d1c  8d 80 e8                           sta VDC
 1160 A:0d1f  ad 81 e8                           lda VDC+1
 1161 A:0d22  29 df                              and #%11011111
 1162 A:0d24  8d 81 e8                           sta VDC+1

 1164 A:0d27                                    ; restore normal registers
 1165 A:0d27  a2 28                              ldx #VCCY_ALT1
 1166 A:0d29  a9 00                              lda #0
 1167 A:0d2b  20 80 10                           jsr sreg
 1168 A:0d2e                                     .) 

 1170 A:0d2e  a9 3f                              lda #63
 1171 A:0d30  8d f8 87                           sta $8800-8        ; sprite pointer

 1173 A:0d33  a2 30                              ldx #VCCY_SPRT_BASE_0+SPRT_XPOS           ; x-pos
 1174 A:0d35  a9 28                              lda #40
 1175 A:0d37  20 80 10                           jsr sreg

 1177 A:0d3a  e8                                 inx                    ; y-pos
 1178 A:0d3b  a9 c8                              lda #200
 1179 A:0d3d  20 80 10                           jsr sreg

 1181 A:0d40  e8                                 inx                    ; x/y high bits
 1182 A:0d41  a9 00                              lda #0
 1183 A:0d43  20 80 10                           jsr sreg

 1185 A:0d46  a2 50                              ldx #VCCY_SPRT_COL_0
 1186 A:0d48  a9 05                              lda #5
 1187 A:0d4a  20 80 10                           jsr sreg                ; fg colour

 1189 A:0d4d  a2 2e                              ldx #VCCY_SPRT_MCOL1
 1190 A:0d4f  a9 03                              lda #3             ; mcol1
 1191 A:0d51  20 80 10                           jsr sreg
 1192 A:0d54  e8                                 inx 
 1193 A:0d55  a9 09                              lda #9             ; mcol2
 1194 A:0d57  20 80 10                           jsr sreg

 1196 A:0d5a  a2 33                              ldx #VCCY_SPRT_BASE_0+SPRT_CTRL
 1197 A:0d5c  a9 e7                              lda #1+2+4+32+64+128; enable, x+y-expand, over border, fine coords, alt palette
 1198 A:0d5e  20 80 10                           jsr sreg

 1200 A:0d61  a9 ad                              lda #<itab
 1201 A:0d63  a0 0d                              ldy #>itab
 1202 A:0d65  20 97 0f                           jsr addirq

 1204 A:0d68  4c 6c 11                           jmp wait

 1206 A:0d6b                           idemo     
 1207 A:0d6b  a5 09                              lda cnt2
 1208 A:0d6d  29 01                              and #$01
 1209 A:0d6f  d0 33                              bne end

 1211 A:0d71  a2 30                              ldx #VCCY_SPRT_BASE_0+SPRT_XPOS
 1212 A:0d73  8e 80 e8                           stx VDC
 1213 A:0d76  ee 81 e8                           inc VDC+1
 1214 A:0d79  d0 18                              bne y

 1216 A:0d7b  a2 32                              ldx #VCCY_SPRT_BASE_0+SPRT_XYPOS
 1217 A:0d7d  8e 80 e8                           stx VDC
 1218 A:0d80  ad 81 e8                           lda VDC+1
 1219 A:0d83  18                                 clc 
 1220 A:0d84  69 01                              adc #1
 1221 A:0d86  29 33                              and #%00110011
 1222 A:0d88  8d 81 e8                           sta VDC+1

 1224 A:0d8b  a2 50                              ldx #VCCY_SPRT_COL_0
 1225 A:0d8d  8e 80 e8                           stx VDC
 1226 A:0d90  ee 81 e8                           inc VDC+1
 1227 A:0d93                           y         
 1228 A:0d93                                    ; ldx #49
 1229 A:0d93                                    ; stx VDC
 1230 A:0d93                                    ; inc VDC+1
 1231 A:0d93                                    ; bne multi

 1233 A:0d93                                    ; ldx #80
 1234 A:0d93                                    ; stx VDC
 1235 A:0d93                                    ; inc VDC+1
 1236 A:0d93  a5 09                    multi     lda cnt2
 1237 A:0d95  d0 0d                              bne end
 1238 A:0d97  a2 33                              ldx #VCCY_SPRT_BASE_0+SPRT_CTRL
 1239 A:0d99  8e 80 e8                           stx VDC
 1240 A:0d9c  ad 81 e8                           lda VDC+1
 1241 A:0d9f  49 08                              eor #8             ; multicolour bit
 1242 A:0da1  8d 81 e8                           sta VDC+1
 1243 A:0da4                           end       
 1244 A:0da4  a9 22                              lda #VCCY_BRDR_COL
 1245 A:0da6  8d 80 e8                           sta VDC
 1246 A:0da9  ee 81 e8                           inc VDC+1
 1247 A:0dac  60                                 rts 

 1249 A:0dad  6a 0d                    itab      .word idemo-1
 1250 A:0daf  23 02                              .word 525+OFFSET70
 1251 A:0db1  00 00                              .word 0

 1253 A:0db3  20 20 20 20 20 20 20 ... txt       .asc "           * SPRITES (SINGLE/MULTICOL,EXPAND,PRIO,ALT PALETTE)"
 1254 A:0df1  0d 00                              .asc CR,0

 1256 A:0df3                           s_balloon 
 1257 A:0df3  00 7f 00 01 ff c0 03 ...           .byt 0,127,0,1,255,192,3,255,224,3,231,224
 1258 A:0dff  07 d9 f0 07 df f0 07 ...           .byt 7,217,240,7,223,240,7,217,240,3,231,224
 1259 A:0e0b  03 ff e0 03 ff e0 02 ...           .byt 3,255,224,3,255,224,2,255,160,1,127,64
 1260 A:0e17  01 3e 40 00 9c 80 00 ...           .byt 1,62,64,0,156,128,0,156,128,0,73,0,0,73,0
 1261 A:0e26  00 3e 00 00 3e 00 00 ...           .byt 0,62,0,0,62,0,0,62,0,0,28,0
 1262 A:0e32                                     .) 

 1264 A:0e32                           sprite_pal 
 1265 A:0e32  00                                 .byt %00000000
 1266 A:0e33  49                                 .byt %01001001
 1267 A:0e34  02                                 .byt %00000010
 1268 A:0e35  4b                                 .byt %01001011
 1269 A:0e36  08                                 .byt %00001000
 1270 A:0e37  18                                 .byt %00011000
 1271 A:0e38  09                                 .byt %00001001
 1272 A:0e39  5b                                 .byt %01011011

 1274 A:0e3a  40                                 .byt %01000000
 1275 A:0e3b  c0                                 .byt %11000000
 1276 A:0e3c  41                                 .byt %01000001
 1277 A:0e3d  cb                                 .byt %11001011
 1278 A:0e3e  48                                 .byt %01001000
 1279 A:0e3f  d9                                 .byt %11011001
 1280 A:0e40  92                                 .byt %10010010
 1281 A:0e41  ff                                 .byt %11111111

 1283 A:0e42                                    ; ---------------------------------------------------------
 1284 A:0e42                                    ; palette demo

 1286 A:0e42                                     .( 

 1288 A:0e42                           demopalette 
 1289 A:0e42  a9 ae                              lda #<txt
 1290 A:0e44  a0 0e                              ldy #>txt
 1291 A:0e46  20 5b 11                           jsr txtout

 1293 A:0e49  a9 e4                              lda #<itab
 1294 A:0e4b  a0 0e                              ldy #>itab
 1295 A:0e4d  20 97 0f                           jsr addirq

 1297 A:0e50  4c 6c 11                           jmp wait

 1299 A:0e53                           idemo     
 1300 A:0e53  a5 09                              lda cnt2
 1301 A:0e55  29 3f                              and #%00111111
 1302 A:0e57  d0 4c                              bne end

 1304 A:0e59  a5 09                              lda cnt2
 1305 A:0e5b  29 c0                              and #%11000000
 1306 A:0e5d  4a                                 lsr 
 1307 A:0e5e  4a                                 lsr 
 1308 A:0e5f  a8                                 tay 

 1310 A:0e60  a2 20                              ldx #VCCY_CTRL
 1311 A:0e62  8e 80 e8                           stx VDC
 1312 A:0e65  ad 81 e8                           lda VDC+1
 1313 A:0e68                                    ;and #%11011111
 1314 A:0e68  29 df                              and #$ff-VCCY_CTRL_PALSEL
 1315 A:0e6a  8d 81 e8                           sta VDC+1
 1316 A:0e6d  48                                 pha 

 1319 A:0e6e  a2 58                              ldx #VCCY_PAL_BASE
 1320 A:0e70  8e 80 e8                           stx VDC
 1321 A:0e73  a2 08                              ldx #8
 1322 A:0e75  b9 ea 0e                 l1        lda pal0,y
 1323 A:0e78  8d 83 e8                           sta VDC+3          ; includes index increment
 1324 A:0e7b  c8                                 iny 
 1325 A:0e7c  ca                                 dex 
 1326 A:0e7d  d0 f6                              bne l1

 1328 A:0e7f  a2 20                              ldx #VCCY_CTRL
 1329 A:0e81  8e 80 e8                           stx VDC
 1330 A:0e84  68                                 pla 
 1331 A:0e85  48                                 pha 
 1332 A:0e86  09 20                              ora #VCCY_CTRL_PALSEL               ;%00100000
 1333 A:0e88  8d 81 e8                           sta VDC+1

 1336 A:0e8b  a2 58                              ldx #VCCY_PAL_BASE
 1337 A:0e8d  8e 80 e8                           stx VDC
 1338 A:0e90  a2 08                              ldx #8
 1339 A:0e92  b9 ea 0e                 l2        lda pal0,y
 1340 A:0e95  8d 83 e8                           sta VDC+3          ; includes index increment
 1341 A:0e98  c8                                 iny 
 1342 A:0e99  ca                                 dex 
 1343 A:0e9a  d0 f6                              bne l2

 1345 A:0e9c  a2 20                              ldx #VCCY_CTRL
 1346 A:0e9e  8e 80 e8                           stx VDC
 1347 A:0ea1  68                                 pla 
 1348 A:0ea2  8d 81 e8                           sta VDC+1

 1350 A:0ea5                           end       
 1351 A:0ea5  a9 22                              lda #VCCY_BRDR_COL
 1352 A:0ea7  8d 80 e8                           sta VDC
 1353 A:0eaa  ee 81 e8                           inc VDC+1
 1354 A:0ead  60                                 rts 

 1356 A:0eae  20 20 20 20 20 20 20 ... txt       .asc "           * DUAL PALETTE FOR 2*16 OUT OF 64 COLOURS"
 1357 A:0ee2  0d 00                              .asc CR,0

 1359 A:0ee4  52 0e                    itab      .word idemo-1
 1360 A:0ee6  26 02                              .word 528+OFFSET70
 1361 A:0ee8  00 00                              .word 0

 1364 A:0eea  00 49 02 6f              pal0      .byt %00000000,%01001001,%00000010,%01101111
 1365 A:0eee  0c 7d 0d 7f                        .byt %00001100,%01111101,%00001101,%01111111
 1366 A:0ef2  60 ed 61 ef                        .byt %01100000,%11101101,%01100001,%11101111
 1367 A:0ef6  6c fd 92 ff                        .byt %01101100,%11111101,%10010010,%11111111

 1369 A:0efa  00 48 00 6c              pal1      .byt %00000000,%01001000,%00000000,%01101100
 1370 A:0efe  0c 7c 0c 7c                        .byt %00001100,%01111100,%00001100,%01111100
 1371 A:0f02  60 ec 60 ec                        .byt %01100000,%11101100,%01100000,%11101100
 1372 A:0f06  6c fc 90 fc                        .byt %01101100,%11111100,%10010000,%11111100

 1374 A:0f0a  00 41 02 63              pal2      .byt %00000000,%01000001,%00000010,%01100011
 1375 A:0f0e  00 61 01 63                        .byt %00000000,%01100001,%00000001,%01100011
 1376 A:0f12  60 e1 61 e3                        .byt %01100000,%11100001,%01100001,%11100011
 1377 A:0f16  60 e1 82 e3                        .byt %01100000,%11100001,%10000010,%11100011

 1379 A:0f1a  00 09 02 0f              pal3      .byt %00000000,%00001001,%00000010,%00001111
 1380 A:0f1e  0c 1d 0d 1f                        .byt %00001100,%00011101,%00001101,%00011111
 1381 A:0f22  00 0d 01 0f                        .byt %00000000,%00001101,%00000001,%00001111
 1382 A:0f26  0c 1d 12 1f                        .byt %00001100,%00011101,%00010010,%00011111

 1384 A:0f2a                                     .) 

 1386 A:0f2a                                    ; ---------------------------------------------------------
 1387 A:0f2a                                    ; irq chain

 1389 A:0f2a  00 00                    last      .word 0
 1390 A:0f2c  00 00                    start     .word 0
 1391 A:0f2e  00 00                    chain     .word 0

 1393 A:0f30                           doirq     .( 
 1394 A:0f30  a2 24                              ldx #VCCY_IRQ_STAT
 1395 A:0f32  a9 7f                              lda #127             ; clear all Viccy interrupts
 1396 A:0f34  20 80 10                           jsr sreg

 1398 A:0f37  ad 2e 0f                           lda chain
 1399 A:0f3a  85 04                              sta p2
 1400 A:0f3c  ad 2f 0f                           lda chain+1
 1401 A:0f3f  85 05                              sta p2+1
 1402 A:0f41  20 8d 0f                           jsr run

 1404 A:0f44  a0 04                              ldy #4
 1405 A:0f46  b1 04                              lda (p2),y
 1406 A:0f48  aa                                 tax 
 1407 A:0f49  c8                                 iny 
 1408 A:0f4a  b1 04                              lda (p2),y
 1409 A:0f4c  d0 04                              bne set
 1410 A:0f4e  e0 00                              cpx #0
 1411 A:0f50  f0 0c                              beq end
 1412 A:0f52  8d 2f 0f                 set       sta chain+1
 1413 A:0f55  85 05                              sta p2+1
 1414 A:0f57  8e 2e 0f                           stx chain
 1415 A:0f5a  86 04                              stx p2
 1416 A:0f5c  d0 10                              bne next
 1417 A:0f5e  ad 2c 0f                 end       lda start
 1418 A:0f61  8d 2e 0f                           sta chain
 1419 A:0f64  85 04                              sta p2
 1420 A:0f66  ad 2d 0f                           lda start+1
 1421 A:0f69  8d 2f 0f                           sta chain+1
 1422 A:0f6c  85 05                              sta p2+1

 1424 A:0f6e                                    ; ldx #VCCY_BRDR_COL
 1425 A:0f6e                                    ; lda #0
 1426 A:0f6e                                    ; jsr sreg
 1427 A:0f6e                           next      

 1429 A:0f6e  a0 02                              ldy #2
 1430 A:0f70  b1 04                              lda (p2),y
 1431 A:0f72  18                                 clc 
 1432 A:0f73  6d 15 11                           adc dynoff
 1433 A:0f76  a2 1e                              ldx #VCCY_RLINE_L
 1434 A:0f78  20 80 10                           jsr sreg
 1435 A:0f7b  c8                                 iny 
 1436 A:0f7c  e8                                 inx 
 1437 A:0f7d  b1 04                              lda (p2),y
 1438 A:0f7f  28                                 plp 
 1439 A:0f80  69 00                              adc #0
 1440 A:0f82  20 80 10                           jsr sreg

 1442 A:0f85  a2 23                              ldx #VCCY_IRQ_CTRL
 1443 A:0f87  a9 01                              lda #1
 1444 A:0f89  20 80 10                           jsr sreg                ; re-enable raster irq

 1446 A:0f8c  60                                 rts 

 1448 A:0f8d                           run       
 1449 A:0f8d  a0 01                              ldy #1
 1450 A:0f8f  b1 04                              lda (p2),y
 1451 A:0f91  48                                 pha 
 1452 A:0f92  88                                 dey 
 1453 A:0f93  b1 04                              lda (p2),y
 1454 A:0f95  48                                 pha 
 1455 A:0f96  60                                 rts 
 1456 A:0f97                                     .) 

 1458 A:0f97                           addirq    .( 
 1459 A:0f97  78                                 sei 
 1460 A:0f98  ae 2a 0f                           ldx last
 1461 A:0f9b  86 02                              stx p1
 1462 A:0f9d  ae 2b 0f                           ldx last+1
 1463 A:0fa0  86 03                              stx p1+1
 1464 A:0fa2  8d 2a 0f                           sta last
 1465 A:0fa5  8c 2b 0f                           sty last+1
 1466 A:0fa8  a0 04                              ldy #4
 1467 A:0faa  91 02                              sta (p1),y
 1468 A:0fac  c8                                 iny 
 1469 A:0fad  ad 2b 0f                           lda last+1
 1470 A:0fb0  91 02                              sta (p1),y
 1471 A:0fb2  58                                 cli 
 1472 A:0fb3  60                                 rts 
 1473 A:0fb4                                     .) 

 1475 A:0fb4                           insirq    .( 
 1476 A:0fb4  78                                 sei 
 1477 A:0fb5  85 06                              sta tmp
 1478 A:0fb7  84 07                              sty tmp+1

 1480 A:0fb9  ae 2c 0f                           ldx start
 1481 A:0fbc  86 02                              stx p1
 1482 A:0fbe  ae 2d 0f                           ldx start+1
 1483 A:0fc1  86 03                              stx p1+1

 1485 A:0fc3  a0 05                              ldy #5
 1486 A:0fc5  b1 02                              lda (p1),y
 1487 A:0fc7  91 06                              sta (tmp),y
 1488 A:0fc9  88                                 dey 
 1489 A:0fca  b1 02                              lda (p1),y
 1490 A:0fcc  91 06                              sta (tmp),y

 1492 A:0fce  a5 06                              lda tmp
 1493 A:0fd0  91 02                              sta (p1),y
 1494 A:0fd2  c8                                 iny 
 1495 A:0fd3  a5 07                              lda tmp+1
 1496 A:0fd5  91 02                              sta (p1),y

 1498 A:0fd7  58                                 cli 
 1499 A:0fd8  60                                 rts 
 1500 A:0fd9                                     .) 

 1502 A:0fd9                           resetchain .( 
 1503 A:0fd9  ad 2c 0f                           lda start
 1504 A:0fdc  85 02                              sta p1
 1505 A:0fde  ad 2d 0f                           lda start+1
 1506 A:0fe1  85 03                              sta p1+1
 1507 A:0fe3  a0 04                    next      ldy #4
 1508 A:0fe5  b1 02                              lda (p1),y
 1509 A:0fe7  48                                 pha 
 1510 A:0fe8  c8                                 iny 
 1511 A:0fe9  b1 02                              lda (p1),y
 1512 A:0feb  aa                                 tax 
 1513 A:0fec  a9 00                              lda #0
 1514 A:0fee  91 02                              sta (p1),y
 1515 A:0ff0  88                                 dey 
 1516 A:0ff1  91 02                              sta (p1),y
 1517 A:0ff3  86 03                              stx p1+1
 1518 A:0ff5  68                                 pla 
 1519 A:0ff6  85 02                              sta p1
 1520 A:0ff8  05 03                              ora p1+1
 1521 A:0ffa  d0 e7                              bne next
 1522 A:0ffc  60                                 rts 
 1523 A:0ffd                                     .) 

 1525 A:0ffd                           stopirq   .( 
 1526 A:0ffd  a2 23                              ldx #VCCY_IRQ_CTRL
 1527 A:0fff  a9 00                              lda #0
 1528 A:1001  4c 80 10                           jmp sreg
 1529 A:1004                                     .) 

 1531 A:1004                           inichain  .( 
 1532 A:1004  a9 31                              lda #<itab
 1533 A:1006  8d 2e 0f                           sta chain
 1534 A:1009  8d 2c 0f                           sta start
 1535 A:100c  8d 2a 0f                           sta last
 1536 A:100f  a9 10                              lda #>itab
 1537 A:1011  8d 2f 0f                           sta chain+1
 1538 A:1014  8d 2d 0f                           sta start+1
 1539 A:1017  8d 2b 0f                           sta last+1

 1541 A:101a  ad 33 10                           lda itab+2
 1542 A:101d  a2 1e                              ldx #VCCY_RLINE_L
 1543 A:101f  20 80 10                           jsr sreg
 1544 A:1022  ad 34 10                           lda itab+3
 1545 A:1025  e8                                 inx 
 1546 A:1026  20 80 10                           jsr sreg

 1548 A:1029  a2 23                              ldx #VCCY_IRQ_CTRL
 1549 A:102b  a9 01                              lda #1             ; enable raster irq
 1550 A:102d  20 80 10                           jsr sreg
 1551 A:1030  60                                 rts 

 1553 A:1031  36 10                    itab      .word resetscr-1
 1554 A:1033  32 02                              .word 540+OFFSET70
 1555 A:1035  00 00                              .word 0

 1557 A:1037                           resetscr  
 1558 A:1037  20 bb 10                           jsr setviccy
 1559 A:103a  60                                 rts 
 1560 A:103b                                     .) 

 1562 A:103b                                    ;setr39 .(
 1563 A:103b                                    ; sta tmp
 1564 A:103b                                    ; ldx #VCCY_CTRL
 1565 A:103b                                    ; stx VDC
 1566 A:103b                                    ; lda VDC+1
 1567 A:103b                                    ; and #%11111100
 1568 A:103b                                    ; ora tmp
 1569 A:103b                                    ; sta VDC+1
 1570 A:103b                                    ; rts
 1571 A:103b                                    ; .)

 1574 A:103b                                    ; ---------------------------------------------------------

 1576 A:103b  00 00                    irqsave   .word 0

 1578 A:103d                           newirq    .( 
 1579 A:103d  a9 24                              lda #VCCY_IRQ_STAT
 1580 A:103f  8d 80 e8                           sta VDC
 1581 A:1042  ad 81 e8                           lda VDC+1          ; irq status
 1582 A:1045  10 06                              bpl noloop
 1583 A:1047  20 30 0f                           jsr doirq
 1584 A:104a  6c 3b 10                 retirq    jmp (irqsave)
 1585 A:104d                           noloop    
 1586 A:104d  e6 09                              inc cnt2
 1587 A:104f  d0 02                              bne e
 1588 A:1051  e6 08                              inc cnt
 1589 A:1053  4c 4a 10                 e         jmp retirq
 1590 A:1056                                     .) 

 1592 A:1056                           iniirq    .( 
 1593 A:1056  a5 90                              lda irqvec
 1594 A:1058  8d 3b 10                           sta irqsave
 1595 A:105b  a5 91                              lda irqvec+1
 1596 A:105d  8d 3c 10                           sta irqsave+1

 1598 A:1060  a9 00                              lda #0
 1599 A:1062  85 08                              sta cnt
 1600 A:1064  85 09                              sta cnt2

 1602 A:1066  08                                 php 
 1603 A:1067  78                                 sei 
 1604 A:1068  a9 3d                              lda #<newirq
 1605 A:106a  85 90                              sta irqvec
 1606 A:106c  a9 10                              lda #>newirq
 1607 A:106e  85 91                              sta irqvec+1
 1608 A:1070  28                                 plp 
 1609 A:1071  60                                 rts 
 1610 A:1072                                     .) 

 1612 A:1072                           freirq    .( 
 1613 A:1072  08                                 php 
 1614 A:1073  78                                 sei 
 1615 A:1074  ad 3b 10                           lda irqsave
 1616 A:1077  85 90                              sta irqvec
 1617 A:1079  ad 3c 10                           lda irqsave+1
 1618 A:107c  85 91                              sta irqvec+1
 1619 A:107e  28                                 plp 
 1620 A:107f  60                                 rts 
 1621 A:1080                                     .) 

 1623 A:1080                                    ; ---------------------------------------------------------

 1625 A:1080                           sreg      .( 
 1626 A:1080  8e 80 e8                           stx VDC
 1627 A:1083  8d 81 e8                           sta VDC+1
 1628 A:1086  60                                 rts 
 1629 A:1087                                     .) 

 1631 A:1087                           clrviccy  .( 
 1632 A:1087  a9 09                              lda #9
 1633 A:1089  8d 01 11                           sta vdctab+VCCY_CHR_HDISP
 1634 A:108c  a9 0f                              lda #15
 1635 A:108e  8d 02 11                           sta vdctab+VCCY_CHR_VDISP

 1637 A:1091  a9 00                              lda #0
 1638 A:1093  a2 33                              ldx #VCCY_SPRT_BASE_0+SPRT_CTRL
 1639 A:1095  20 80 10                           jsr sreg
 1640 A:1098  a2 37                              ldx #VCCY_SPRT_BASE_1+SPRT_CTRL
 1641 A:109a  20 80 10                           jsr sreg
 1642 A:109d  a2 3b                              ldx #VCCY_SPRT_BASE_2+SPRT_CTRL
 1643 A:109f  20 80 10                           jsr sreg
 1644 A:10a2  a2 3f                              ldx #VCCY_SPRT_BASE_3+SPRT_CTRL
 1645 A:10a4  20 80 10                           jsr sreg
 1646 A:10a7  a2 43                              ldx #VCCY_SPRT_BASE_4+SPRT_CTRL
 1647 A:10a9  20 80 10                           jsr sreg
 1648 A:10ac  a2 47                              ldx #VCCY_SPRT_BASE_5+SPRT_CTRL
 1649 A:10ae  20 80 10                           jsr sreg
 1650 A:10b1  a2 4b                              ldx #VCCY_SPRT_BASE_6+SPRT_CTRL
 1651 A:10b3  20 80 10                           jsr sreg
 1652 A:10b6  a2 4f                              ldx #VCCY_SPRT_BASE_7+SPRT_CTRL
 1653 A:10b8  20 80 10                           jsr sreg

 1655 A:10bb                           setviccy  
 1656 A:10bb  a9 03                              lda #SPEED
 1657 A:10bd  8d 03 e8                           sta SCTRL                ; 12 MHz CPU
 1658 A:10c0  a9 00                              lda #0             ; 40 column, display enable
 1659 A:10c2  8d 00 e8                           sta VCTRL
 1660 A:10c5  a2 20                              ldx #VCCY_CTRL               ; r39
 1661 A:10c7  a9 14                              lda #20
 1662 A:10c9  20 80 10                           jsr sreg                ; disable uPET compat mode
 1663 A:10cc  a2 08                              ldx #VCCY_MODE               ; r8
 1664 A:10ce  a9 80                              lda #128
 1665 A:10d0  20 80 10                           jsr sreg                ; 80 col mode via Viccy
 1666 A:10d3  a2 28                              ldx #VCCY_ALT1               ; r46
 1667 A:10d5  a9 00                              lda #0             ; disable any alt modes
 1668 A:10d7  20 80 10                           jsr sreg

 1670 A:10da  a0 00                              ldy #0
 1671 A:10dc  8c 80 e8                           sty VDC                ; register number
 1672 A:10df  b9 eb 10                 l0        lda vdctab,y
 1673 A:10e2                                    ; cpy #VCCY_VPOS
 1674 A:10e2                                    ; bne nooff
 1675 A:10e2                                    ; clc
 1676 A:10e2                                    ; adc dynoff
 1677 A:10e2  8d 83 e8                 nooff     sta VDC+3       ; register value w/ auto-inc of register number
 1678 A:10e5  c8                       lx        iny 
 1679 A:10e6  c0 2a                              cpy #42
 1680 A:10e8  90 f5                              bcc l0
 1681 A:10ea  60                                 rts 

 1683 A:10eb  00                       vdctab    .byt 0           ; r0 ignored
 1684 A:10ec  50                                 .byt 80              ; r1 number of chars per line displayed
 1685 A:10ed  00 00 00 00                        .byt 0,0,0,0; r2-5 ignored
 1686 A:10f1  19                                 .byt 25              ; r6 char rows displayed
 1687 A:10f2  00                                 .byt 0              ; r7 ignored
 1688 A:10f3  80                                 .byt 128              ; r8: b7= 80 col mode; b1=interlace, b0=double
 1689 A:10f4  08                                 .byt 8              ; r9: rows per char (-1)
 1690 A:10f5  20                                 .byt 32              ; r10: cursor start (b0-4, b6/5= mode, 00=solid, 01=off, 1x= blink)
 1691 A:10f6  07                                 .byt 7              ; r11: cursor end line
 1692 A:10f7  90                                 .byt >$9000             ; r12: start of vid memory high
 1693 A:10f8  00                                 .byt <$9000             ; r13: start of vid memory low
 1694 A:10f9  92                                 .byt >$9000+9*80+11; r14: cursor pos high
 1695 A:10fa  db                                 .byt <$9000+9*80+11; r15: cursor pos low
 1696 A:10fb  00 00 00 00                        .byt 0,0,0,0; r16-r19: ignored
 1697 A:10ff  d0                                 .byt >$d000             ; r20: start of attribute memory high
 1698 A:1100  00                                 .byt <$d000             ; r21: start of attribute memory low
 1699 A:1101  09                                 .byt 9              ; r22: ignored
 1700 A:1102  0f                                 .byt 15              ; r23: character rows displayed
 1701 A:1103  00                                 .byt 0              ; r24: b0-3 scroll down, b4: up/low border ext, b5 blink rate, b6: reverse
 1702 A:1104  10                                 .byt 16              ; r25: b0-3 scroll right, b4: l/r border ext, b6: attrib enable, b7: bitmap mode
 1703 A:1105  10                                 .byt BGCOL+16          ; r26: b0-3: bg colour, b4-7: fg colour
 1704 A:1106  00                                 .byt 0              ; r27: address incr
 1705 A:1107  00                                 .byt >$00             ; r28: char set address high
 1706 A:1108  07                                 .byt 7              ; r29: underline scanline
 1707 A:1109  00 00                              .byt 0,0        ; r30/31: rasterline counter low/high
 1708 A:110b  14                                 .byt 4+16        ; r32 (was r39): b2: extended (cpet compat), b4: disp en, b7: upet compat
 1709 A:110c  0f                                 .byt $0f              ; r33 (was r40): b0-3: bg colour 1, b4-7: bg colour 2
 1710 A:110d  00                                 .byt BRDCOL                ; r34 (was r41): border colour (b0-3)
 1711 A:110e  00                                 .byt 0              ; r35 (was r42): irq control
 1712 A:110f  7f                                 .byt 127              ; r36 (was r43): irq status (clear all sources)
 1713 A:1110  00                                 .byt 0              ; r37: v/h sync status (VDC)
 1714 A:1111  15                                 .byt 21              ; r38 (was r44): horizontal position (chars)
 1715 A:1112                                    ;.byt 14  ; r38 (was r44): horizontal position (chars)
 1716 A:1112                                    ;.byt 28  ; r38 (was r44): horizontal position (chars)
 1717 A:1112                                    ;.byt 59+OFFSET70; r39 (was r45): vertical position (rasterlines)
 1718 A:1112  5b                                 .byt 69+OFFSET70          ; r39 (was r45): vertical position (rasterlines)
 1719 A:1113  00                                 .byt 0              ; r40 (was r46): alt match
 1720 A:1114  00                                 .byt 0              ; r41 (was r47): alt raster row

 1722 A:1115                                     .) 

 1724 A:1115  00                       dynoff    .byt 0

 1727 A:1116                           clrscr    .( 
 1728 A:1116  a9 00                              lda #<$8000
 1729 A:1118  85 02                              sta p1
 1730 A:111a  a9 80                              lda #>$8000
 1731 A:111c  85 03                              sta p1+1
 1732 A:111e  a2 08                              ldx #8             ; number of pages
 1733 A:1120  a9 20                              lda #32             ; screen space
 1734 A:1122  a0 00                              ldy #0
 1735 A:1124  91 02                    l0        sta (p1),y
 1736 A:1126  c8                                 iny 
 1737 A:1127  d0 fb                              bne l0
 1738 A:1129  e6 03                              inc p1+1
 1739 A:112b  ca                                 dex 
 1740 A:112c  d0 f6                              bne l0
 1741 A:112e  a2 08                              ldx #8
 1742 A:1130  a9 05                              lda #FGCOL               ; light green
 1743 A:1132  91 02                    l1        sta (p1),y
 1744 A:1134  c8                                 iny 
 1745 A:1135  d0 fb                              bne l1
 1746 A:1137  e6 03                              inc p1+1
 1747 A:1139  ca                                 dex 
 1748 A:113a  d0 f6                              bne l1
 1749 A:113c  60                                 rts 
 1750 A:113d                                     .) 

 1752 A:113d                           hexout    .( 
 1753 A:113d  48                                 pha 
 1754 A:113e  4a                                 lsr 
 1755 A:113f  4a                                 lsr 
 1756 A:1140  4a                                 lsr 
 1757 A:1141  4a                                 lsr 
 1758 A:1142  20 48 11                           jsr digout
 1759 A:1145  68                                 pla 
 1760 A:1146  29 0f                              and #$0f
 1761 A:1148  c9 0a                    digout    cmp #10          ; http:
 1762 A:114a  90 02                              bcc d1
 1763 A:114c  69 66                              adc #$66
 1764 A:114e  49 30                    d1        eor #$30
 1765 A:1150  4c d2 ff                           jmp BSOUT
 1766 A:1153                                     .) 

 1768 A:1153  a9 0d                    crout     lda #13
 1769 A:1155  2c                                 .byt $2c
 1770 A:1156  a9 20                    spout     lda #$20
 1771 A:1158  4c d2 ff                           jmp BSOUT

 1773 A:115b                           txtout    .( 
 1774 A:115b  85 02                              sta p1
 1775 A:115d  84 03                              sty p1+1
 1776 A:115f  a0 00                              ldy #0
 1777 A:1161  b1 02                    l0        lda (p1),y
 1778 A:1163  f0 06                              beq end
 1779 A:1165  20 d2 ff                           jsr BSOUT
 1780 A:1168  c8                                 iny 
 1781 A:1169  d0 f6                              bne l0
 1782 A:116b  60                       end       rts 
 1783 A:116c                                     .) 

 1785 A:116c                           wait      .( 
 1786 A:116c  a2 00                              ldx #0
 1787 A:116e  a0 00                              ldy #0
 1788 A:1170  ea                       l0        nop 
 1789 A:1171  a9 32                              lda #50
 1790 A:1173  38                       l1        sec 
 1791 A:1174  e9 01                              sbc #1
 1792 A:1176  d0 fb                              bne l1
 1793 A:1178  ea                                 nop 
 1794 A:1179  ea                                 nop 
 1795 A:117a  ea                                 nop 
 1796 A:117b  ea                                 nop 
 1797 A:117c  88                                 dey 
 1798 A:117d  d0 f1                              bne l0
 1799 A:117f  ca                                 dex 
 1800 A:1180  d0 ee                              bne l0
 1801 A:1182  60                                 rts 
 1802 A:1183                                     .) 
